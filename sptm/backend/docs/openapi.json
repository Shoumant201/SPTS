{
  "openapi": "3.0.0",
  "info": {
    "title": "SPTM Backend API",
    "version": "1.0.0",
    "description": "\n          Smart Public Transport Management (SPTM) Backend API\n          \n          This API provides comprehensive endpoints for managing a multi-tier public transport system.\n          It supports different user types (Super Admin, Admin, Organization, Driver, Passenger) with\n          context-aware authentication and role-based access control.\n          \n          ## Authentication Flows\n          \n          The API uses JWT (JSON Web Tokens) for authentication with context-aware routing.\n          Each user type has specific authentication endpoints and access patterns:\n          \n          ### Web Dashboard Authentication\n          - **Super Admin**: `POST /api/auth/web/super-admin/login`\n          - **Admin**: `POST /api/auth/web/admin/login`\n          - **Organization**: `POST /api/auth/web/organization/login`\n          \n          ### Mobile App Authentication\n          - **Driver Login**: `POST /api/auth/mobile/driver/login`\n          - **Driver Registration**: `POST /api/auth/mobile/driver/register`\n          - **Passenger Login**: `POST /api/auth/mobile/passenger/login`\n          - **Passenger Registration**: `POST /api/auth/mobile/passenger/register`\n          \n          ### Universal Endpoints\n          - **Logout**: `POST /api/auth/logout` (no authentication required)\n          - **Profile**: `GET /api/auth/me`, `GET /api/auth/profile`\n          - **Token Refresh**: Context-specific refresh endpoints\n          \n          ## Context Header Requirements\n          \n          The `X-App-Context` header is **REQUIRED** for most authentication endpoints:\n          \n          | Context | Allowed Roles | Description |\n          |---------|---------------|-------------|\n          | `web-dashboard` | SUPER_ADMIN, ADMIN, ORGANIZATION | Web dashboard access |\n          | `driver-app` | DRIVER | Driver mobile app access |\n          | `passenger-app` | PASSENGER | Passenger mobile app access |\n          \n          ### Context Validation Rules\n          1. Context header must match user's role capabilities\n          2. Web dashboard users cannot access mobile endpoints\n          3. Mobile app users cannot access web dashboard endpoints\n          4. Context mismatch results in 401 Unauthorized error\n          \n          ## JWT Token Structure\n          \n          **Access Token** (15 minutes validity):\n          ```json\n          {\n            \"sub\": \"user_id\",\n            \"name\": \"User Name\",\n            \"role\": \"DRIVER|PASSENGER|ADMIN|ORGANIZATION|SUPER_ADMIN\",\n            \"userType\": \"USER|ORGANIZATION|ADMIN|SUPER_ADMIN\",\n            \"organizationId\": \"org_xxxxxxxxx\", // for drivers only\n            \"context\": \"web-dashboard|driver-app|passenger-app\",\n            \"iat\": 1732876800,\n            \"exp\": 1732877700\n          }\n          ```\n          \n          **Refresh Token** (7-30 days validity based on user type):\n          ```json\n          {\n            \"sub\": \"user_id\",\n            \"type\": \"refresh\",\n            \"userType\": \"SUPER_ADMIN|ADMIN|ORGANIZATION|USER\",\n            \"context\": \"web-dashboard|driver-app|passenger-app\",\n            \"iat\": 1732876800,\n            \"exp\": 1733481600\n          }\n          ```\n          \n          ## Token Expiration Policies\n          \n          ### Role-Based Expiration Times\n          \n          | User Type | Access Token | Refresh Token | Security Level |\n          |-----------|--------------|---------------|----------------|\n          | SUPER_ADMIN | 30 minutes | 7 days | Highest |\n          | ADMIN | 1 hour | 7 days | High |\n          | ORGANIZATION | 2 hours | 14 days | Medium |\n          | USER (Driver/Passenger) | 4 hours | 30 days | Standard |\n          \n          ### Token Renewal Process\n          \n          1. **Automatic Refresh**: Clients should refresh tokens before expiration\n          2. **Token Rotation**: Each refresh generates new access and refresh tokens\n          3. **Context Validation**: Refresh requests must match original context\n          4. **Database Validation**: Refresh tokens are validated against stored values\n          5. **User Status Check**: User account status is verified during refresh\n          \n          ### Refresh Endpoints by Context\n          \n          **Web Dashboard**:\n          - `POST /api/auth/web/super-admin/refresh-token`\n          - `POST /api/auth/web/admin/refresh-token`\n          - `POST /api/auth/web/organization/refresh-token`\n          \n          **Mobile Apps**:\n          - `POST /api/auth/mobile/driver/refresh-token`\n          - `POST /api/auth/mobile/passenger/refresh-token`\n          \n          ## User Type Hierarchy & Access Control\n          \n          The SPTM system implements a multi-tier user hierarchy with role-based access control (RBAC) and organization boundaries.\n          \n          ### User Type Hierarchy (Highest to Lowest Authority)\n          \n          | User Type | Role | Authority Level | Organization Boundary | Context Access |\n          |-----------|------|-----------------|----------------------|----------------|\n          | **SUPER_ADMIN** | SUPER_ADMIN | 4 (Highest) | None | web-dashboard |\n          | **ADMIN** | ADMIN | 3 | None | web-dashboard |\n          | **ORGANIZATION** | ORGANIZATION | 2 | Own Organization | web-dashboard |\n          | **USER (Driver)** | DRIVER | 1 | Own Organization | driver-app |\n          | **USER (Passenger)** | PASSENGER | 1 | None | passenger-app |\n          \n          ### User Type Definitions\n          \n          #### SUPER_ADMIN (Authority Level 4)\n          - **Purpose**: System-wide administration and oversight\n          - **Access**: Unrestricted access to all system resources\n          - **Permissions**: \n            - Manage all admins, organizations, and users\n            - Access all system metrics and configurations\n            - Override any organizational boundaries\n            - Full CRUD operations on all resources\n          - **Organization Boundary**: None (can access all organizations)\n          - **Context**: web-dashboard only\n          - **Login Endpoint**: `POST /api/auth/web/super-admin/login`\n          \n          #### ADMIN (Authority Level 3)\n          - **Purpose**: Regional or system-level administration\n          - **Access**: Cross-organizational management capabilities\n          - **Permissions**:\n            - Create and manage organizations\n            - Manage routes, vehicles, and system-wide configurations\n            - Approve/reject verification requests\n            - Access system metrics and reports\n            - Cannot manage other admins or super admins\n          - **Organization Boundary**: None (can access all organizations)\n          - **Context**: web-dashboard only\n          - **Login Endpoint**: `POST /api/auth/web/admin/login`\n          \n          #### ORGANIZATION (Authority Level 2)\n          - **Purpose**: Organization-specific management\n          - **Access**: Limited to own organization's resources\n          - **Permissions**:\n            - Manage drivers within their organization\n            - Manage vehicles assigned to their organization\n            - View routes and trips related to their organization\n            - Update organization profile and settings\n            - Cannot access other organizations' data\n          - **Organization Boundary**: Strict (own organization only)\n          - **Context**: web-dashboard only\n          - **Login Endpoint**: `POST /api/auth/web/organization/login`\n          \n          #### USER - DRIVER (Authority Level 1)\n          - **Purpose**: Vehicle operation and trip management\n          - **Access**: Limited to own profile and assigned resources\n          - **Permissions**:\n            - View and update own profile\n            - View assigned vehicle information\n            - View assigned routes\n            - Update trip status and information\n            - Cannot access other drivers' data\n          - **Organization Boundary**: Strict (own organization only)\n          - **Context**: driver-app only\n          - **Registration**: `POST /api/auth/mobile/driver/register` (requires organizationId)\n          - **Login Endpoint**: `POST /api/auth/mobile/driver/login`\n          \n          #### USER - PASSENGER (Authority Level 1)\n          - **Purpose**: Trip booking and profile management\n          - **Access**: Limited to own profile and public resources\n          - **Permissions**:\n            - View and update own profile\n            - Book and manage own trips\n            - View public routes and schedules\n            - Apply for and manage discount profiles\n            - Submit verification documents\n          - **Organization Boundary**: None (not tied to specific organization)\n          - **Context**: passenger-app only\n          - **Registration**: `POST /api/auth/mobile/passenger/register` (no organizationId required)\n          - **Login Endpoint**: `POST /api/auth/mobile/passenger/login`\n          \n          ### Access Control Rules\n          \n          #### Hierarchical Access\n          - Higher authority levels can access resources of lower levels within their scope\n          - SUPER_ADMIN can access all resources without restrictions\n          - ADMIN can access organization and user resources but not other admin resources\n          - ORGANIZATION can only access their own organization's resources\n          - USER level (DRIVER/PASSENGER) can only access their own resources\n          \n          #### Organization Boundary Enforcement\n          - **No Boundary**: SUPER_ADMIN, ADMIN, PASSENGER\n          - **Strict Boundary**: ORGANIZATION, DRIVER\n          - Organization boundary violations result in 403 Forbidden errors\n          \n          #### Context-Based Access Control\n          - **web-dashboard**: SUPER_ADMIN, ADMIN, ORGANIZATION\n          - **driver-app**: DRIVER only\n          - **passenger-app**: PASSENGER only\n          - Context mismatches result in 401 Unauthorized errors\n          \n          ### Permission Matrix\n          \n          | Resource | SUPER_ADMIN | ADMIN | ORGANIZATION | DRIVER | PASSENGER |\n          |----------|-------------|-------|--------------|--------|-----------|\n          | System Config | Full | Read | None | None | None |\n          | Admins | Full | None | None | None | None |\n          | Organizations | Full | Full | Own Only | None | None |\n          | Users/Drivers | Full | Read | Own Org | Own Profile | Own Profile |\n          | Vehicles | Full | Read | Own Org | Assigned Only | Read Only |\n          | Routes | Full | Full | Read | Read | Read |\n          | Trips | Full | Read | Own Org | Own Only | Own Only |\n          | Discounts | Full | Manage | None | None | Own Profile |\n          | Verification | Full | Approve/Reject | None | None | Submit |\n          \n          ## Authentication Flow Examples\n          \n          ### Driver Registration & Login Flow\n          1. **Get Organizations**: `GET /api/auth/organizations/active`\n          2. **Register**: `POST /api/auth/mobile/driver/register` with organizationId\n          3. **Login**: `POST /api/auth/mobile/driver/login`\n          4. **Access Protected**: Use Bearer token with X-App-Context: driver-app\n          \n          ### Passenger Registration & Login Flow\n          1. **Register**: `POST /api/auth/mobile/passenger/register` (no organizationId)\n          2. **Login**: `POST /api/auth/mobile/passenger/login`\n          3. **Access Protected**: Use Bearer token with X-App-Context: passenger-app\n          \n          ### Web Dashboard Login Flow\n          1. **Login**: `POST /api/auth/web/{role}/login` (super-admin/admin/organization)\n          2. **Access Protected**: Use Bearer token with X-App-Context: web-dashboard\n          \n          ## Error Handling\n          \n          Common authentication errors:\n          - **401 Unauthorized**: Invalid credentials, expired tokens, context mismatch\n          - **409 Conflict**: Account locked, email already exists\n          - **429 Too Many Requests**: Rate limit exceeded\n          - **400 Bad Request**: Validation errors, weak passwords\n          \n          ## Rate Limiting\n          \n          Authentication endpoints are rate-limited:\n          - Login attempts: 5 per 15 minutes per IP\n          - Registration: 3 per hour per IP\n          - Token refresh: 10 per minute per user\n          \n          Rate limit headers are included in responses, and exceeded limits return HTTP 429.\n        ",
    "contact": {
      "name": "SPTM Development Team",
      "email": "dev@sptm.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    },
    "x-generated-at": "2025-11-29T18:06:22.032Z",
    "x-generator": "SPTM OpenAPI Generator"
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Development server (current)",
      "variables": {
        "version": {
          "default": "v1",
          "description": "API version",
          "enum": [
            "v1"
          ]
        },
        "protocol": {
          "default": "http",
          "description": "Protocol scheme",
          "enum": [
            "http",
            "https"
          ]
        }
      }
    },
    {
      "url": "https://staging-api.sptm.com",
      "description": "Staging server (for testing)",
      "variables": {
        "version": {
          "default": "v1",
          "description": "API version",
          "enum": [
            "v1"
          ]
        }
      }
    },
    {
      "url": "https://api.sptm.com",
      "description": "Production server (live)",
      "variables": {
        "version": {
          "default": "v1",
          "description": "API version",
          "enum": [
            "v1"
          ]
        }
      }
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token obtained from login endpoint. Include as: Authorization: Bearer <token>"
      },
      "AppContext": {
        "type": "apiKey",
        "in": "header",
        "name": "X-App-Context",
        "description": "Application context header. Required values: web-dashboard, driver-app, or passenger-app"
      }
    },
    "responses": {
      "ValidationError": {
        "description": "Validation error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "weakPassword": {
                "summary": "Weak password error",
                "value": {
                  "error": {
                    "type": "WEAK_PASSWORD",
                    "message": "Password does not meet security requirements",
                    "code": 400,
                    "details": {
                      "requirements": [
                        "Password must contain at least one uppercase letter",
                        "Password must contain at least one special character",
                        "Password must be at least 8 characters long"
                      ],
                      "field": "password"
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/register"
                }
              }
            }
          }
        }
      },
      "AuthenticationError": {
        "description": "Authentication failed",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "invalidCredentials": {
                "summary": "Invalid credentials",
                "value": {
                  "error": "Invalid email or password",
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/login"
                }
              }
            }
          }
        }
      },
      "AuthorizationError": {
        "description": "Authorization failed - Insufficient permissions",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "ConflictError": {
        "description": "Resource conflict - Duplicate or conflicting data",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "RateLimitError": {
        "description": "Rate limit exceeded - Too many requests",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "rateLimitExceeded": {
                "summary": "Standard rate limit exceeded",
                "value": {
                  "error": {
                    "type": "RATE_LIMIT_EXCEEDED",
                    "message": "Too many requests. Please try again later.",
                    "code": 429,
                    "details": {
                      "retryAfter": 300,
                      "limit": 5,
                      "remaining": 0,
                      "resetTime": "2025-11-29T12:05:00.000Z",
                      "userType": "USER",
                      "windowMs": 900000,
                      "endpoint": "login"
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/login"
                }
              },
              "superAdminRateLimit": {
                "summary": "Super admin rate limit exceeded",
                "value": {
                  "error": {
                    "type": "RATE_LIMIT_EXCEEDED",
                    "message": "Too many requests. Please try again later.",
                    "code": 429,
                    "details": {
                      "retryAfter": 1800,
                      "limit": 10,
                      "remaining": 0,
                      "resetTime": "2025-11-29T12:30:00.000Z",
                      "userType": "SUPER_ADMIN",
                      "windowMs": 900000,
                      "blockDuration": 1800
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/web/super-admin/login"
                }
              }
            }
          }
        },
        "headers": {
          "X-RateLimit-Limit": {
            "description": "Maximum requests allowed in the time window",
            "schema": {
              "type": "integer"
            },
            "example": 5
          },
          "X-RateLimit-Remaining": {
            "description": "Number of requests remaining in current window",
            "schema": {
              "type": "integer"
            },
            "example": 0
          },
          "X-RateLimit-Reset": {
            "description": "Unix timestamp when the rate limit window resets",
            "schema": {
              "type": "integer"
            },
            "example": 1732877700
          },
          "Retry-After": {
            "description": "Seconds to wait before making another request",
            "schema": {
              "type": "integer"
            },
            "example": 300
          }
        }
      },
      "SecurityError": {
        "description": "Security-related errors including account lockout and security violations",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "accountLocked": {
                "summary": "Account locked due to failed attempts",
                "value": {
                  "error": {
                    "type": "ACCOUNT_LOCKED",
                    "message": "Account is temporarily locked due to multiple failed login attempts",
                    "code": 423,
                    "details": {
                      "lockedUntil": "2025-11-29T12:30:00.000Z",
                      "lockoutDuration": 1800,
                      "failedAttempts": 5,
                      "maxFailedAttempts": 5,
                      "userType": "USER",
                      "resetTime": "2025-11-29T14:00:00.000Z",
                      "unlockMethod": "automatic"
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/login"
                }
              },
              "contextSecurityViolation": {
                "summary": "Context security violation",
                "value": {
                  "error": {
                    "type": "CONTEXT_SECURITY_VIOLATION",
                    "message": "Request context does not match user authorization",
                    "code": 401,
                    "details": {
                      "userRole": "DRIVER",
                      "requestContext": "web-dashboard",
                      "allowedContexts": [
                        "driver-app"
                      ],
                      "violationType": "CONTEXT_MISMATCH",
                      "severity": "HIGH",
                      "actionTaken": "LOGGED"
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/web/admin/login"
                }
              },
              "ipBlocked": {
                "summary": "IP address blocked due to security",
                "value": {
                  "error": {
                    "type": "IP_BLOCKED",
                    "message": "IP address has been temporarily blocked due to suspicious activity",
                    "code": 423,
                    "details": {
                      "ipAddress": "192.168.1.100",
                      "blockedUntil": "2025-11-29T13:00:00.000Z",
                      "reason": "Multiple failed authentication attempts",
                      "blockDuration": 3600,
                      "violationType": "RAPID_REQUESTS",
                      "severity": "MEDIUM",
                      "actionTaken": "IP_BLOCKED"
                    }
                  },
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/login"
                }
              }
            }
          }
        }
      },
      "ServerError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "internalError": {
                "summary": "Generic internal server error",
                "value": {
                  "error": "Internal server error",
                  "timestamp": "2025-11-29T12:00:00.000Z",
                  "path": "/api/auth/login"
                }
              }
            }
          }
        }
      }
    },
    "parameters": {
      "AppContextHeader": {
        "name": "X-App-Context",
        "in": "header",
        "required": true,
        "description": "Application context identifier",
        "schema": {
          "type": "string",
          "enum": [
            "web-dashboard",
            "driver-app",
            "passenger-app"
          ]
        }
      }
    },
    "examples": {
      "SuperAdminLoginFlow": {
        "summary": "Super Admin Web Dashboard Login Flow",
        "description": "Complete authentication flow for Super Admin users accessing the web dashboard.\n\n**Step 1: Login Request**\n```\nPOST /api/auth/web/super-admin/login\nHeaders:\n  Content-Type: application/json\n  X-App-Context: web-dashboard\n\nBody:\n{\n  \"email\": \"superadmin@sptm.com\",\n  \"password\": \"SuperSecure123!\"\n}\n```\n\n**Step 2: Success Response**\n```\nHTTP 200 OK\n{\n  \"message\": \"Login successful\",\n  \"user\": {\n    \"id\": \"cmik7w7h700037fm9zv7btfaz\",\n    \"email\": \"superadmin@sptm.com\",\n    \"name\": \"System Administrator\",\n    \"role\": \"SUPER_ADMIN\",\n    \"userType\": \"SUPER_ADMIN\",\n    \"organizationId\": null,\n    \"isActive\": true,\n    \"createdAt\": \"2025-11-29T10:00:00.000Z\"\n  },\n  \"tokens\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n  }\n}\n```\n\n**Step 3: Using Access Token**\n```\nGET /api/auth/me\nHeaders:\n  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n  X-App-Context: web-dashboard\n```\n\n**Context Requirements:**\n- X-App-Context header MUST be \"web-dashboard\"\n- Super Admin can access all administrative functions\n- Token valid for 15 minutes, refresh token valid for 7 days\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/web/super-admin/login",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "web-dashboard"
            },
            "body": {
              "email": "superadmin@sptm.com",
              "password": "SuperSecure123!"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Login successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfaz",
                "email": "superadmin@sptm.com",
                "name": "System Administrator",
                "role": "SUPER_ADMIN",
                "userType": "SUPER_ADMIN",
                "organizationId": null,
                "isActive": true,
                "createdAt": "2025-11-29T10:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwibmFtZSI6IlN5c3RlbSBBZG1pbmlzdHJhdG9yIiwicm9sZSI6IlNVUEVSX0FETUlOIiwidXNlclR5cGUiOiJTVVBFUl9BRE1JTiIsImNvbnRleHQiOiJ3ZWItZGFzaGJvYXJkIiwiaWF0IjoxNzMyODc2ODAwLCJleHAiOjE3MzI4Nzc3MDB9.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0Ijoid2ViLWRhc2hib2FyZCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "AdminLoginFlow": {
        "summary": "Admin Web Dashboard Login Flow",
        "description": "Complete authentication flow for Admin users accessing the web dashboard.\n\n**Step 1: Login Request**\n```\nPOST /api/auth/web/admin/login\nHeaders:\n  Content-Type: application/json\n  X-App-Context: web-dashboard\n\nBody:\n{\n  \"email\": \"admin@citytransport.com\",\n  \"password\": \"AdminPass123!\"\n}\n```\n\n**Step 2: Success Response**\nAdmin users have access to organization management but not system-wide settings.\n\n**Context Requirements:**\n- X-App-Context header MUST be \"web-dashboard\"\n- Admin can manage organizations and users within their scope\n- Cannot access super admin functions\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/web/admin/login",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "web-dashboard"
            },
            "body": {
              "email": "admin@citytransport.com",
              "password": "AdminPass123!"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Login successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfab",
                "email": "admin@citytransport.com",
                "name": "City Transport Admin",
                "role": "ADMIN",
                "userType": "ADMIN",
                "organizationId": null,
                "isActive": true,
                "createdAt": "2025-11-29T10:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFiIiwibmFtZSI6IkNpdHkgVHJhbnNwb3J0IEFkbWluIiwicm9sZSI6IkFETUlOIiwidXNlclR5cGUiOiJBRE1JTiIsImNvbnRleHQiOiJ3ZWItZGFzaGJvYXJkIiwiaWF0IjoxNzMyODc2ODAwLCJleHAiOjE3MzI4Nzc3MDB9.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFiIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0Ijoid2ViLWRhc2hib2FyZCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "OrganizationLoginFlow": {
        "summary": "Organization Web Dashboard Login Flow",
        "description": "Complete authentication flow for Organization users accessing the web dashboard.\n\n**Step 1: Login Request**\n```\nPOST /api/auth/web/organization/login\nHeaders:\n  Content-Type: application/json\n  X-App-Context: web-dashboard\n\nBody:\n{\n  \"email\": \"manager@citytransport.com\",\n  \"password\": \"OrgPass123!\"\n}\n```\n\n**Context Requirements:**\n- X-App-Context header MUST be \"web-dashboard\"\n- Organization users can only manage their own organization's data\n- Cannot access admin or super admin functions\n- Usually associated with a specific organizationId\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/web/organization/login",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "web-dashboard"
            },
            "body": {
              "email": "manager@citytransport.com",
              "password": "OrgPass123!"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Login successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfac",
                "email": "manager@citytransport.com",
                "name": "Transport Manager",
                "role": "ORGANIZATION",
                "userType": "ORGANIZATION",
                "organizationId": "org_123456789",
                "isActive": true,
                "createdAt": "2025-11-29T10:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFjIiwibmFtZSI6IlRyYW5zcG9ydCBNYW5hZ2VyIiwicm9sZSI6Ik9SR0FOSVpBVElPTiIsInVzZXJUeXBlIjoiT1JHQU5JWkFUSU9OIiwib3JnYW5pemF0aW9uSWQiOiJvcmdfMTIzNDU2Nzg5IiwiY29udGV4dCI6IndlYi1kYXNoYm9hcmQiLCJpYXQiOjE3MzI4NzY4MDAsImV4cCI6MTczMjg3NzcwMH0.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFjIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0Ijoid2ViLWRhc2hib2FyZCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "DriverLoginFlow": {
        "summary": "Driver Mobile App Login Flow",
        "description": "Complete authentication flow for Driver users accessing the mobile app.\n\n**Step 1: Login Request**\n```\nPOST /api/auth/mobile/driver/login\nHeaders:\n  Content-Type: application/json\n  X-App-Context: driver-app\n\nBody:\n{\n  \"email\": \"driver@citytransport.com\",\n  \"password\": \"DriverPass123!\"\n}\n```\n\n**Step 2: Success Response**\nDriver users are associated with an organization and have mobile-specific permissions.\n\n**Context Requirements:**\n- X-App-Context header MUST be \"driver-app\"\n- Driver must be associated with an active organization\n- Access to driver-specific mobile endpoints only\n- Cannot access web dashboard endpoints\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/mobile/driver/login",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "driver-app"
            },
            "body": {
              "email": "driver@citytransport.com",
              "password": "DriverPass123!"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Login successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfad",
                "email": "driver@citytransport.com",
                "name": "John Driver",
                "role": "DRIVER",
                "userType": "USER",
                "organizationId": "org_123456789",
                "isActive": true,
                "createdAt": "2025-11-29T10:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFkIiwibmFtZSI6IkpvaG4gRHJpdmVyIiwicm9sZSI6IkRSSVZFUiIsInVzZXJUeXBlIjoiVVNFUiIsIm9yZ2FuaXphdGlvbklkIjoib3JnXzEyMzQ1Njc4OSIsImNvbnRleHQiOiJkcml2ZXItYXBwIiwiaWF0IjoxNzMyODc2ODAwLCJleHAiOjE3MzI4Nzc3MDB9.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFkIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0IjoiZHJpdmVyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "DriverRegistrationFlow": {
        "summary": "Driver Mobile App Registration Flow",
        "description": "Complete registration flow for new Driver users.\n\n**Step 1: Get Active Organizations**\n```\nGET /api/auth/organizations/active\nHeaders:\n  Content-Type: application/json\n```\n\n**Step 2: Registration Request**\n```\nPOST /api/auth/mobile/driver/register\nHeaders:\n  Content-Type: application/json\n  X-App-Context: driver-app\n\nBody:\n{\n  \"email\": \"newdriver@citytransport.com\",\n  \"password\": \"SecurePass123!\",\n  \"name\": \"Jane Driver\",\n  \"phone\": \"+1234567890\",\n  \"organizationId\": \"org_123456789\"\n}\n```\n\n**Context Requirements:**\n- X-App-Context header MUST be \"driver-app\"\n- organizationId is REQUIRED for driver registration\n- Organization must be active and accepting new drivers\n- Password must meet security requirements\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/mobile/driver/register",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "driver-app"
            },
            "body": {
              "email": "newdriver@citytransport.com",
              "password": "SecurePass123!",
              "name": "Jane Driver",
              "phone": "+1234567890",
              "organizationId": "org_123456789"
            }
          },
          "response": {
            "status": 201,
            "body": {
              "message": "Registration successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfae",
                "email": "newdriver@citytransport.com",
                "name": "Jane Driver",
                "role": "DRIVER",
                "userType": "USER",
                "organizationId": "org_123456789",
                "isActive": true,
                "createdAt": "2025-11-29T12:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFlIiwibmFtZSI6IkphbmUgRHJpdmVyIiwicm9sZSI6IkRSSVZFUiIsInVzZXJUeXBlIjoiVVNFUiIsIm9yZ2FuaXphdGlvbklkIjoib3JnXzEyMzQ1Njc4OSIsImNvbnRleHQiOiJkcml2ZXItYXBwIiwiaWF0IjoxNzMyODc2ODAwLCJleHAiOjE3MzI4Nzc3MDB9.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFlIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0IjoiZHJpdmVyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "PassengerLoginFlow": {
        "summary": "Passenger Mobile App Login Flow",
        "description": "Complete authentication flow for Passenger users accessing the mobile app.\n\n**Step 1: Login Request**\n```\nPOST /api/auth/mobile/passenger/login\nHeaders:\n  Content-Type: application/json\n  X-App-Context: passenger-app\n\nBody:\n{\n  \"email\": \"passenger@example.com\",\n  \"password\": \"PassengerPass123!\"\n}\n```\n\n**Context Requirements:**\n- X-App-Context header MUST be \"passenger-app\"\n- Passengers are not associated with organizations\n- Access to passenger-specific mobile endpoints only\n- Cannot access web dashboard or driver endpoints\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/mobile/passenger/login",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "passenger-app"
            },
            "body": {
              "email": "passenger@example.com",
              "password": "PassengerPass123!"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Login successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfaf",
                "email": "passenger@example.com",
                "name": "Jane Passenger",
                "role": "PASSENGER",
                "userType": "USER",
                "organizationId": null,
                "isActive": true,
                "createdAt": "2025-11-29T10:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFmIiwibmFtZSI6IkphbmUgUGFzc2VuZ2VyIiwicm9sZSI6IlBBU1NFTkdFUiIsInVzZXJUeXBlIjoiVVNFUiIsIm9yZ2FuaXphdGlvbklkIjpudWxsLCJjb250ZXh0IjoicGFzc2VuZ2VyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMyODc3NzAwfQ.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFmIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0IjoicGFzc2VuZ2VyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "PassengerRegistrationFlow": {
        "summary": "Passenger Mobile App Registration Flow",
        "description": "Complete registration flow for new Passenger users.\n\n**Step 1: Registration Request**\n```\nPOST /api/auth/mobile/passenger/register\nHeaders:\n  Content-Type: application/json\n  X-App-Context: passenger-app\n\nBody:\n{\n  \"email\": \"newpassenger@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"name\": \"John Passenger\",\n  \"phone\": \"+1234567890\"\n}\n```\n\n**Context Requirements:**\n- X-App-Context header MUST be \"passenger-app\"\n- organizationId is NOT required for passenger registration\n- Password must meet security requirements\n- Phone number is optional but recommended\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/mobile/passenger/register",
            "headers": {
              "Content-Type": "application/json",
              "X-App-Context": "passenger-app"
            },
            "body": {
              "email": "newpassenger@example.com",
              "password": "SecurePass123!",
              "name": "John Passenger",
              "phone": "+1234567890"
            }
          },
          "response": {
            "status": 201,
            "body": {
              "message": "Registration successful",
              "user": {
                "id": "cmik7w7h700037fm9zv7btfag",
                "email": "newpassenger@example.com",
                "name": "John Passenger",
                "role": "PASSENGER",
                "userType": "USER",
                "organizationId": null,
                "isActive": true,
                "createdAt": "2025-11-29T12:00:00.000Z"
              },
              "tokens": {
                "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFnIiwibmFtZSI6IkpvaG4gUGFzc2VuZ2VyIiwicm9sZSI6IlBBU1NFTkdFUiIsInVzZXJUeXBlIjoiVVNFUiIsIm9yZ2FuaXphdGlvbklkIjpudWxsLCJjb250ZXh0IjoicGFzc2VuZ2VyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMyODc3NzAwfQ.example_signature",
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmFnIiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0IjoicGFzc2VuZ2VyLWFwcCIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMzNDgxNjAwfQ.example_signature"
              }
            }
          }
        }
      },
      "TokenRefreshFlow": {
        "summary": "Token Refresh Flow",
        "description": "Complete token refresh flow for all user types.\n\n**Step 1: Refresh Token Request**\n```\nPOST /api/auth/web/super-admin/refresh-token\nHeaders:\n  Authorization: Bearer <refresh_token>\n  X-App-Context: web-dashboard\n```\n\n**Step 2: Success Response**\nNew access and refresh tokens are provided.\n\n**Context Requirements:**\n- Use the appropriate refresh endpoint for your user type\n- X-App-Context header must match the original login context\n- Refresh token must be valid and not expired\n- Old tokens are invalidated after successful refresh\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/web/super-admin/refresh-token",
            "headers": {
              "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
              "X-App-Context": "web-dashboard"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwibmFtZSI6IlN5c3RlbSBBZG1pbmlzdHJhdG9yIiwicm9sZSI6IlNVUEVSX0FETUlOIiwidXNlclR5cGUiOiJTVVBFUl9BRE1JTiIsImNvbnRleHQiOiJ3ZWItZGFzaGJvYXJkIiwiaWF0IjoxNzMyODc3NzAwLCJleHAiOjE3MzI4Nzg2MDB9.new_signature",
              "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwidHlwZSI6InJlZnJlc2giLCJjb250ZXh0Ijoid2ViLWRhc2hib2FyZCIsImlhdCI6MTczMjg3NzcwMCwiZXhwIjoxNzMzNDgyNTAwfQ.new_signature"
            }
          }
        }
      },
      "UniversalLogoutFlow": {
        "summary": "Universal Logout Flow",
        "description": "Universal logout flow that works for all user types and contexts.\n\n**Step 1: Logout Request**\n```\nPOST /api/auth/logout\nHeaders:\n  Content-Type: application/json\n```\n\n**Step 2: Success Response**\nLogout always succeeds, even without authentication.\n\n**Context Requirements:**\n- No authentication required\n- No context header required\n- Always returns success\n- Invalidates tokens on server side if provided\n",
        "value": {
          "request": {
            "method": "POST",
            "url": "/api/auth/logout",
            "headers": {
              "Content-Type": "application/json"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "message": "Logout successful"
            }
          }
        }
      },
      "UserProfileFlow": {
        "summary": "User Profile Access Flow",
        "description": "Accessing user profile information with proper authentication.\n\n**Step 1: Get Current User**\n```\nGET /api/auth/me\nHeaders:\n  Authorization: Bearer <access_token>\n  X-App-Context: <original_context>\n```\n\n**Step 2: Get Detailed Profile**\n```\nGET /api/auth/profile\nHeaders:\n  Authorization: Bearer <access_token>\n  X-App-Context: <original_context>\n```\n\n**Context Requirements:**\n- Valid access token required\n- X-App-Context must match the context used during login\n- Returns user information based on permissions\n",
        "value": {
          "request": {
            "method": "GET",
            "url": "/api/auth/me",
            "headers": {
              "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
              "X-App-Context": "driver-app"
            }
          },
          "response": {
            "status": 200,
            "body": {
              "id": "cmik7w7h700037fm9zv7btfad",
              "email": "driver@citytransport.com",
              "name": "John Driver",
              "role": "DRIVER",
              "userType": "USER",
              "organizationId": "org_123456789",
              "isActive": true,
              "createdAt": "2025-11-29T10:00:00.000Z"
            }
          }
        }
      },
      "ContextHeaderRequirements": {
        "summary": "Context Header Requirements",
        "description": "The X-App-Context header is crucial for proper authentication and authorization.\n\n**Valid Context Values:**\n- `web-dashboard`: For web dashboard access (Super Admin, Admin, Organization)\n- `driver-app`: For driver mobile app access\n- `passenger-app`: For passenger mobile app access\n\n**Context Validation Rules:**\n1. Context header is required for most authentication endpoints\n2. User's role must be compatible with the requested context\n3. Web dashboard users cannot access mobile endpoints and vice versa\n4. Context mismatch results in 401 Unauthorized error\n\n**Examples of Context Mismatches:**\n\n**❌ Driver trying to access web dashboard:**\n```\nPOST /api/auth/web/admin/login\nHeaders:\n  X-App-Context: web-dashboard\nBody:\n  email: \"driver@citytransport.com\"  // Driver role\n  password: \"DriverPass123!\"\n\nResponse: 401 Unauthorized\n{\n  \"error\": {\n    \"type\": \"CONTEXT_MISMATCH\",\n    \"message\": \"User role DRIVER is not allowed in web-dashboard context\"\n  }\n}\n```\n\n**❌ Admin trying to access mobile app:**\n```\nPOST /api/auth/mobile/driver/login\nHeaders:\n  X-App-Context: driver-app\nBody:\n  email: \"admin@citytransport.com\"  // Admin role\n  password: \"AdminPass123!\"\n\nResponse: 401 Unauthorized\n{\n  \"error\": {\n    \"type\": \"CONTEXT_MISMATCH\",\n    \"message\": \"User role ADMIN is not allowed in driver-app context\"\n  }\n}\n```\n\n**✅ Correct Context Usage:**\n- Super Admin, Admin, Organization → web-dashboard\n- Driver → driver-app\n- Passenger → passenger-app\n",
        "value": {
          "validContexts": [
            "web-dashboard",
            "driver-app",
            "passenger-app"
          ],
          "contextRoleMapping": {
            "web-dashboard": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION"
            ],
            "driver-app": [
              "DRIVER"
            ],
            "passenger-app": [
              "PASSENGER"
            ]
          },
          "contextMismatchExample": {
            "request": {
              "method": "POST",
              "url": "/api/auth/web/admin/login",
              "headers": {
                "X-App-Context": "web-dashboard"
              },
              "body": {
                "email": "driver@citytransport.com",
                "password": "DriverPass123!"
              }
            },
            "response": {
              "status": 401,
              "body": {
                "error": {
                  "type": "CONTEXT_MISMATCH",
                  "message": "User role DRIVER is not allowed in web-dashboard context",
                  "code": 401,
                  "details": {
                    "userRole": "DRIVER",
                    "requestedContext": "web-dashboard",
                    "allowedContexts": [
                      "driver-app"
                    ]
                  }
                },
                "timestamp": "2025-11-29T12:00:00.000Z",
                "path": "/api/auth/web/admin/login"
              }
            }
          }
        }
      },
      "AuthenticationErrorFlows": {
        "summary": "Common Authentication Error Flows",
        "description": "Examples of common authentication errors and their responses.\n\n**1. Invalid Credentials**\n```\nPOST /api/auth/mobile/driver/login\nHeaders:\n  X-App-Context: driver-app\nBody:\n  email: \"driver@citytransport.com\"\n  password: \"WrongPassword\"\n\nResponse: 401 Unauthorized\n{\n  \"error\": \"Invalid email or password\",\n  \"timestamp\": \"2025-11-29T12:00:00.000Z\",\n  \"path\": \"/api/auth/mobile/driver/login\"\n}\n```\n\n**2. Missing Context Header**\n```\nPOST /api/auth/mobile/driver/login\nBody:\n  email: \"driver@citytransport.com\"\n  password: \"DriverPass123!\"\n\nResponse: 401 Unauthorized\n{\n  \"error\": {\n    \"type\": \"MISSING_CONTEXT_HEADER\",\n    \"message\": \"X-App-Context header is required\",\n    \"details\": {\n      \"validContexts\": [\"web-dashboard\", \"driver-app\", \"passenger-app\"]\n    }\n  }\n}\n```\n\n**3. Account Locked**\n```\nResponse: 409 Conflict\n{\n  \"error\": {\n    \"type\": \"ACCOUNT_LOCKED\",\n    \"message\": \"Account has been locked due to multiple failed login attempts\",\n    \"details\": {\n      \"lockoutDuration\": 1800,\n      \"unlockTime\": \"2025-11-29T12:30:00.000Z\"\n    }\n  }\n}\n```\n\n**4. Rate Limit Exceeded**\n```\nResponse: 429 Too Many Requests\n{\n  \"error\": {\n    \"type\": \"RATE_LIMIT_EXCEEDED\",\n    \"message\": \"Too many requests\",\n    \"details\": {\n      \"retryAfter\": 300,\n      \"limit\": 5,\n      \"remaining\": 0,\n      \"resetTime\": \"2025-11-29T12:05:00.000Z\"\n    }\n  }\n}\n```\n",
        "value": {
          "invalidCredentials": {
            "status": 401,
            "body": {
              "error": "Invalid email or password",
              "timestamp": "2025-11-29T12:00:00.000Z",
              "path": "/api/auth/mobile/driver/login"
            }
          },
          "missingContextHeader": {
            "status": 401,
            "body": {
              "error": {
                "type": "MISSING_CONTEXT_HEADER",
                "message": "X-App-Context header is required",
                "code": 401,
                "details": {
                  "validContexts": [
                    "web-dashboard",
                    "driver-app",
                    "passenger-app"
                  ]
                }
              },
              "timestamp": "2025-11-29T12:00:00.000Z",
              "path": "/api/auth/mobile/driver/login"
            }
          },
          "accountLocked": {
            "status": 409,
            "body": {
              "error": {
                "type": "ACCOUNT_LOCKED",
                "message": "Account has been locked due to multiple failed login attempts",
                "code": 409,
                "details": {
                  "lockoutDuration": 1800,
                  "attemptsRemaining": 0,
                  "unlockTime": "2025-11-29T12:30:00.000Z"
                }
              },
              "timestamp": "2025-11-29T12:00:00.000Z",
              "path": "/api/auth/mobile/driver/login"
            }
          },
          "rateLimitExceeded": {
            "status": 429,
            "body": {
              "error": {
                "type": "RATE_LIMIT_EXCEEDED",
                "message": "Too many requests",
                "code": 429,
                "details": {
                  "retryAfter": 300,
                  "limit": 5,
                  "remaining": 0,
                  "resetTime": "2025-11-29T12:05:00.000Z"
                }
              },
              "timestamp": "2025-11-29T12:00:00.000Z",
              "path": "/api/auth/mobile/driver/login"
            }
          }
        }
      },
      "ContextBasedRoutingExamples": {
        "summary": "Context-Based Routing Examples",
        "description": "# X-App-Context Header Usage Guide\n\nThe `X-App-Context` header is the primary mechanism for context-based routing in the SPTM API. This header determines which authentication flow is used, what permissions are granted, and which endpoints are accessible.\n\n## Header Format\n\n```http\nX-App-Context: <context-value>\n```\n\nWhere `<context-value>` is one of:\n- `web-dashboard`\n- `driver-app`\n- `passenger-app`\n\n## Context-Specific Routing\n\n### Web Dashboard Context (`web-dashboard`)\n\n**Purpose**: Administrative access to the SPTM system through web interface\n\n**Allowed User Roles**:\n- `SUPER_ADMIN`: Full system access, can manage all aspects\n- `ADMIN`: Administrative access, can manage organizations and users\n- `ORGANIZATION`: Organization-specific management access\n\n**Routing Behavior**:\n- Routes to web-specific authentication controllers\n- Enables access to administrative endpoints\n- Provides web-optimized response formats\n- Supports multi-tier permission hierarchy\n\n**Example Usage**:\n```http\nPOST /api/auth/web/super-admin/login\nX-App-Context: web-dashboard\nContent-Type: application/json\n\n{\n  \"email\": \"superadmin@sptm.com\",\n  \"password\": \"SuperSecure123!\"\n}\n```\n\n**Available Endpoints**:\n- `/api/auth/web/super-admin/*` (Super Admin only)\n- `/api/auth/web/admin/*` (Admin and above)\n- `/api/auth/web/organization/*` (Organization and above)\n- All protected administrative endpoints\n\n### Driver App Context (`driver-app`)\n\n**Purpose**: Mobile application access for bus drivers\n\n**Allowed User Roles**:\n- `DRIVER`: Bus drivers associated with transport organizations\n\n**Routing Behavior**:\n- Routes to mobile-specific authentication controllers\n- Automatically sets user role to DRIVER during registration\n- Requires organization association\n- Provides mobile-optimized response formats\n\n**Example Usage**:\n```http\nPOST /api/auth/mobile/driver/login\nX-App-Context: driver-app\nContent-Type: application/json\n\n{\n  \"email\": \"driver@citytransport.com\",\n  \"password\": \"DriverPass123!\"\n}\n```\n\n**Available Endpoints**:\n- `/api/auth/mobile/driver/*` (Driver-specific endpoints)\n- Driver-specific protected endpoints\n- Route and shift management endpoints\n- Incident reporting endpoints\n\n**Special Requirements**:\n- Must be associated with an active organization\n- Organization ID required during registration\n- Cannot access web dashboard endpoints\n\n### Passenger App Context (`passenger-app`)\n\n**Purpose**: Mobile application access for bus passengers\n\n**Allowed User Roles**:\n- `PASSENGER`: General public users of the transport system\n\n**Routing Behavior**:\n- Routes to mobile-specific authentication controllers\n- Automatically sets user role to PASSENGER during registration\n- No organization association required\n- Provides mobile-optimized response formats\n\n**Example Usage**:\n```http\nPOST /api/auth/mobile/passenger/login\nX-App-Context: passenger-app\nContent-Type: application/json\n\n{\n  \"email\": \"passenger@example.com\",\n  \"password\": \"PassengerPass123!\"\n}\n```\n\n**Available Endpoints**:\n- `/api/auth/mobile/passenger/*` (Passenger-specific endpoints)\n- Passenger-specific protected endpoints\n- Trip booking and payment endpoints\n- Real-time tracking endpoints\n\n## Context Validation Process\n\n### 1. Header Extraction\n```typescript\nconst appContext = req.get('X-App-Context');\nif (!appContext) {\n  return res.status(400).json({\n    error: {\n      type: \"MISSING_CONTEXT_HEADER\",\n      message: \"X-App-Context header is required\"\n    }\n  });\n}\n```\n\n### 2. Context Validation\n```typescript\nconst validContexts = ['web-dashboard', 'driver-app', 'passenger-app'];\nif (!validContexts.includes(appContext)) {\n  return res.status(400).json({\n    error: {\n      type: \"INVALID_CONTEXT\",\n      message: `Invalid context: ${appContext}`,\n      details: { validContexts }\n    }\n  });\n}\n```\n\n### 3. Path-Context Matching\n```typescript\n// Web dashboard context must match web paths\nif (appContext === 'web-dashboard' && !req.path.includes('/web/')) {\n  return res.status(400).json({\n    error: {\n      type: \"CONTEXT_PATH_MISMATCH\",\n      message: \"Web dashboard context requires web endpoint\"\n    }\n  });\n}\n\n// Mobile contexts must match mobile paths\nif (appContext.endsWith('-app') && !req.path.includes('/mobile/')) {\n  return res.status(400).json({\n    error: {\n      type: \"CONTEXT_PATH_MISMATCH\", \n      message: \"Mobile context requires mobile endpoint\"\n    }\n  });\n}\n```\n\n### 4. Role-Context Compatibility\n```typescript\nconst contextRoleMap = {\n  'web-dashboard': ['SUPER_ADMIN', 'ADMIN', 'ORGANIZATION'],\n  'driver-app': ['DRIVER'],\n  'passenger-app': ['PASSENGER']\n};\n\nif (!contextRoleMap[appContext].includes(userRole)) {\n  return res.status(401).json({\n    error: {\n      type: \"CONTEXT_ROLE_MISMATCH\",\n      message: `Role ${userRole} not allowed in ${appContext} context`\n    }\n  });\n}\n```\n\n## Token Context Integration\n\n### JWT Token Claims\nWhen a user successfully authenticates, the JWT token includes context information:\n\n```json\n{\n  \"sub\": \"user_id\",\n  \"name\": \"User Name\",\n  \"role\": \"DRIVER\",\n  \"userType\": \"USER\",\n  \"context\": \"driver-app\",\n  \"organizationId\": \"org_123\",\n  \"iat\": 1732876800,\n  \"exp\": 1732877700\n}\n```\n\n### Token Validation\nFor protected endpoints, the token context must match the request context:\n\n```http\nGET /api/auth/me\nAuthorization: Bearer <jwt_token>\nX-App-Context: driver-app\n```\n\nIf the token was issued for `driver-app` context but the request uses `web-dashboard` context:\n\n```json\n{\n  \"error\": {\n    \"type\": \"TOKEN_CONTEXT_MISMATCH\",\n    \"message\": \"Token context does not match request context\",\n    \"details\": {\n      \"tokenContext\": \"driver-app\",\n      \"requestContext\": \"web-dashboard\"\n    }\n  }\n}\n```\n\n## Cross-Context Restrictions\n\n### Prohibited Cross-Context Access\n\n**❌ Driver accessing web dashboard:**\n```http\nPOST /api/auth/web/admin/login\nX-App-Context: web-dashboard\n\n{\n  \"email\": \"driver@transport.com\",  // DRIVER role\n  \"password\": \"DriverPass123!\"\n}\n\nResponse: 401 Unauthorized\n```\n\n**❌ Admin accessing mobile app:**\n```http\nPOST /api/auth/mobile/driver/login\nX-App-Context: driver-app\n\n{\n  \"email\": \"admin@transport.com\",  // ADMIN role\n  \"password\": \"AdminPass123!\"\n}\n\nResponse: 401 Unauthorized\n```\n\n**❌ Using wrong context for endpoint:**\n```http\nPOST /api/auth/mobile/driver/login\nX-App-Context: passenger-app  // Wrong context!\n\nResponse: 400 Bad Request\n```\n\n### Context Switching\nUsers cannot switch contexts without re-authentication:\n\n```http\n// First login with driver context\nPOST /api/auth/mobile/driver/login\nX-App-Context: driver-app\n\n// Later attempt to use web context with same token\nGET /api/auth/me\nAuthorization: Bearer <driver_token>\nX-App-Context: web-dashboard  // Will fail!\n\nResponse: 401 Unauthorized - Token context mismatch\n```\n\n## Error Handling and Debugging\n\n### Common Error Scenarios\n\n**1. Missing Context Header**\n```http\nPOST /api/auth/mobile/driver/login\n// Missing X-App-Context header\n\nResponse: 400 Bad Request\n{\n  \"error\": {\n    \"type\": \"MISSING_CONTEXT_HEADER\",\n    \"message\": \"X-App-Context header is required\",\n    \"details\": {\n      \"validContexts\": [\"web-dashboard\", \"driver-app\", \"passenger-app\"]\n    }\n  }\n}\n```\n\n**2. Invalid Context Value**\n```http\nPOST /api/auth/mobile/driver/login\nX-App-Context: invalid-context\n\nResponse: 400 Bad Request\n{\n  \"error\": {\n    \"type\": \"INVALID_CONTEXT\",\n    \"message\": \"Invalid context value: invalid-context\",\n    \"details\": {\n      \"providedContext\": \"invalid-context\",\n      \"validContexts\": [\"web-dashboard\", \"driver-app\", \"passenger-app\"]\n    }\n  }\n}\n```\n\n**3. Context-Path Mismatch**\n```http\nPOST /api/auth/web/admin/login\nX-App-Context: driver-app  // Mobile context for web endpoint\n\nResponse: 400 Bad Request\n{\n  \"error\": {\n    \"type\": \"CONTEXT_PATH_MISMATCH\",\n    \"message\": \"Mobile context cannot be used with web endpoints\"\n  }\n}\n```\n\n**4. Role-Context Incompatibility**\n```http\nPOST /api/auth/web/super-admin/login\nX-App-Context: web-dashboard\n\n{\n  \"email\": \"driver@transport.com\",  // DRIVER role\n  \"password\": \"DriverPass123!\"\n}\n\nResponse: 401 Unauthorized\n{\n  \"error\": {\n    \"type\": \"CONTEXT_ROLE_MISMATCH\",\n    \"message\": \"User role DRIVER is not allowed in web-dashboard context\",\n    \"details\": {\n      \"userRole\": \"DRIVER\",\n      \"requestedContext\": \"web-dashboard\",\n      \"allowedContexts\": [\"driver-app\"]\n    }\n  }\n}\n```\n\n### Debug Information\nAll error responses include detailed debugging information:\n- Timestamp of the error\n- Request path that caused the error\n- Specific error type and code\n- Contextual details for troubleshooting\n- Suggested valid alternatives\n\n## Best Practices\n\n### Client Implementation\n1. **Always include X-App-Context header** in authentication requests\n2. **Store context with tokens** to ensure consistency\n3. **Handle context errors gracefully** with user-friendly messages\n4. **Validate context before making requests** to prevent errors\n\n### Server-Side Validation\n1. **Validate context early** in the middleware chain\n2. **Log context mismatches** for security monitoring\n3. **Provide detailed error messages** for debugging\n4. **Implement rate limiting per context** to prevent abuse\n\n### Security Considerations\n1. **Never bypass context validation** for convenience\n2. **Monitor cross-context access attempts** as potential security threats\n3. **Implement context-specific rate limiting** to prevent abuse\n4. **Audit context switching attempts** for compliance\n\n## Integration Examples\n\n### Frontend Integration (React/TypeScript)\n```typescript\n// Define context types\ntype AppContext = 'web-dashboard' | 'driver-app' | 'passenger-app';\n\n// API client with context\nclass APIClient {\n  constructor(private context: AppContext) {}\n  \n  async login(email: string, password: string) {\n    return fetch('/api/auth/login', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-App-Context': this.context\n      },\n      body: JSON.stringify({ email, password })\n    });\n  }\n  \n  async authenticatedRequest(url: string, options: RequestInit = {}) {\n    return fetch(url, {\n      ...options,\n      headers: {\n        ...options.headers,\n        'X-App-Context': this.context,\n        'Authorization': `Bearer ${this.getToken()}`\n      }\n    });\n  }\n}\n\n// Usage\nconst webClient = new APIClient('web-dashboard');\nconst driverClient = new APIClient('driver-app');\nconst passengerClient = new APIClient('passenger-app');\n```\n\n### Mobile App Integration (React Native)\n```typescript\n// Context-aware authentication service\nclass AuthService {\n  private context: AppContext;\n  \n  constructor(context: AppContext) {\n    this.context = context;\n  }\n  \n  async login(credentials: LoginCredentials) {\n    try {\n      const response = await axios.post('/api/auth/login', credentials, {\n        headers: {\n          'X-App-Context': this.context\n        }\n      });\n      \n      // Store context with token\n      await AsyncStorage.setItem('auth_context', this.context);\n      await AsyncStorage.setItem('access_token', response.data.tokens.accessToken);\n      \n      return response.data;\n    } catch (error) {\n      if (error.response?.data?.error?.type === 'CONTEXT_ROLE_MISMATCH') {\n        throw new Error('This account cannot be used with this app');\n      }\n      throw error;\n    }\n  }\n}\n\n// App-specific services\nconst driverAuth = new AuthService('driver-app');\nconst passengerAuth = new AuthService('passenger-app');\n```\n",
        "value": {
          "contextValues": [
            "web-dashboard",
            "driver-app",
            "passenger-app"
          ],
          "contextRoleMapping": {
            "web-dashboard": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION"
            ],
            "driver-app": [
              "DRIVER"
            ],
            "passenger-app": [
              "PASSENGER"
            ]
          },
          "validationRules": [
            "X-App-Context header is required for all authentication endpoints",
            "Context value must be one of the valid context values",
            "User role must be compatible with requested context",
            "Token context must match request context for protected endpoints"
          ],
          "errorTypes": [
            "MISSING_CONTEXT_HEADER",
            "INVALID_CONTEXT",
            "CONTEXT_PATH_MISMATCH",
            "CONTEXT_ROLE_MISMATCH",
            "TOKEN_CONTEXT_MISMATCH"
          ]
        }
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "required": [
          "id",
          "email",
          "name",
          "role",
          "userType",
          "isActive",
          "createdAt"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9]{25}$",
            "description": "Unique user identifier (25 character alphanumeric string)",
            "example": "cmik7w7h700037fm9zv7btfaz"
          },
          "email": {
            "type": "string",
            "format": "email",
            "maxLength": 255,
            "description": "User email address (valid email format, max 255 characters)",
            "example": "user@example.com"
          },
          "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100,
            "description": "User full name (2-100 characters, letters, spaces, hyphens, dots, apostrophes only)",
            "example": "John Doe"
          },
          "role": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION",
              "DRIVER",
              "PASSENGER"
            ],
            "description": "User role in the system",
            "example": "DRIVER"
          },
          "userType": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION",
              "USER"
            ],
            "description": "User type for access control (hierarchical permission level)",
            "example": "USER"
          },
          "organizationId": {
            "type": "string",
            "pattern": "^org_[a-zA-Z0-9]{9}$",
            "nullable": true,
            "description": "Associated organization ID (required for drivers, format org_xxxxxxxxx)",
            "example": "org_123456789"
          },
          "isActive": {
            "type": "boolean",
            "description": "Whether the user account is active",
            "example": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Account creation timestamp (ISO 8601 format)",
            "example": "2025-11-29T10:00:00.000Z"
          }
        }
      },
      "AuthResponse": {
        "type": "object",
        "required": [
          "message",
          "user",
          "tokens"
        ],
        "properties": {
          "message": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Success message indicating authentication result",
            "example": "Login successful"
          },
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "tokens": {
            "type": "object",
            "required": [
              "accessToken",
              "refreshToken"
            ],
            "properties": {
              "accessToken": {
                "type": "string",
                "pattern": "^[A-Za-z0-9\\-_]+\\.[A-Za-z0-9\\-_]+\\.[A-Za-z0-9\\-_]+$",
                "description": "JWT access token (valid for 15 minutes)",
                "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwibmFtZSI6IkpvaG4gRG9lIiwicm9sZSI6IkRSSVZFUiIsInVzZXJUeXBlIjoiVVNFUiIsImlhdCI6MTczMjg3NjgwMCwiZXhwIjoxNzMyODc3NzAwfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
              },
              "refreshToken": {
                "type": "string",
                "pattern": "^[A-Za-z0-9\\-_]+\\.[A-Za-z0-9\\-_]+\\.[A-Za-z0-9\\-_]+$",
                "description": "JWT refresh token (valid for 7 days)",
                "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWlrN3c3aDcwMDAzN2ZtOXp2N2J0ZmF6IiwidHlwZSI6InJlZnJlc2giLCJpYXQiOjE3MzI4NzY4MDAsImV4cCI6MTczMzQ4MTYwMH0.cThIIoDvwdueQB468K5xDc5633seEFoqwxjF_xSJyQQ"
              }
            }
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "email",
          "password"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "maxLength": 255,
            "description": "User email address (valid email format, max 255 characters)",
            "example": "user@example.com"
          },
          "password": {
            "type": "string",
            "format": "password",
            "minLength": 1,
            "maxLength": 128,
            "description": "User password (1-128 characters)",
            "example": "Password123!"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "required": [
          "error",
          "timestamp",
          "path"
        ],
        "properties": {
          "error": {
            "oneOf": [
              {
                "type": "string",
                "description": "Simple error message",
                "example": "Invalid email or password"
              },
              {
                "type": "object",
                "required": [
                  "type",
                  "message",
                  "code"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "description": "Error type identifier",
                    "example": "WEAK_PASSWORD"
                  },
                  "message": {
                    "type": "string",
                    "description": "Human-readable error message",
                    "example": "Password does not meet security requirements"
                  },
                  "code": {
                    "type": "integer",
                    "description": "HTTP status code",
                    "example": 400
                  },
                  "details": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/ValidationErrorDetails"
                      },
                      {
                        "$ref": "#/components/schemas/RateLimitErrorDetails"
                      },
                      {
                        "$ref": "#/components/schemas/AccountLockoutDetails"
                      },
                      {
                        "$ref": "#/components/schemas/SecurityViolationDetails"
                      },
                      {
                        "type": "object",
                        "description": "Additional error-specific details"
                      }
                    ]
                  }
                }
              }
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Error timestamp",
            "example": "2025-11-29T12:00:00.000Z"
          },
          "path": {
            "type": "string",
            "description": "API endpoint path where error occurred",
            "example": "/api/auth/login"
          }
        }
      },
      "ValidationErrorDetails": {
        "type": "object",
        "properties": {
          "requirements": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of validation requirements that failed",
            "example": [
              "Password must contain at least one uppercase letter",
              "Password must contain at least one special character"
            ]
          },
          "field": {
            "type": "string",
            "description": "Field that failed validation",
            "example": "password"
          },
          "value": {
            "description": "The invalid value (may be omitted for security)"
          }
        }
      },
      "RateLimitErrorDetails": {
        "type": "object",
        "required": [
          "retryAfter",
          "limit",
          "remaining",
          "resetTime"
        ],
        "properties": {
          "retryAfter": {
            "type": "integer",
            "description": "Seconds to wait before retrying",
            "example": 300
          },
          "limit": {
            "type": "integer",
            "description": "Rate limit threshold",
            "example": 5
          },
          "remaining": {
            "type": "integer",
            "description": "Remaining requests in current window",
            "example": 0
          },
          "resetTime": {
            "type": "string",
            "format": "date-time",
            "description": "When the rate limit window resets",
            "example": "2025-11-29T12:05:00.000Z"
          },
          "userType": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION",
              "USER"
            ],
            "description": "User type that determines rate limit policy",
            "example": "USER"
          },
          "windowMs": {
            "type": "integer",
            "description": "Rate limit window duration in milliseconds",
            "example": 900000
          },
          "endpoint": {
            "type": "string",
            "description": "Specific endpoint that was rate limited",
            "example": "login"
          },
          "blockDuration": {
            "type": "integer",
            "description": "Duration of rate limit block in seconds",
            "example": 600
          }
        }
      },
      "AccountLockoutDetails": {
        "type": "object",
        "description": "Details about account lockout status and configuration",
        "required": [
          "lockedUntil",
          "lockoutDuration",
          "failedAttempts",
          "maxFailedAttempts",
          "userType",
          "resetTime"
        ],
        "properties": {
          "lockedUntil": {
            "type": "string",
            "format": "date-time",
            "description": "ISO timestamp when the account lockout expires",
            "example": "2025-11-29T12:30:00.000Z"
          },
          "lockoutDuration": {
            "type": "integer",
            "description": "Duration of the lockout in seconds",
            "example": 1800
          },
          "failedAttempts": {
            "type": "integer",
            "description": "Number of failed attempts that triggered the lockout",
            "example": 5
          },
          "maxFailedAttempts": {
            "type": "integer",
            "description": "Maximum allowed failed attempts before lockout",
            "example": 5
          },
          "userType": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "ADMIN",
              "ORGANIZATION",
              "USER"
            ],
            "description": "User type that determines lockout policy",
            "example": "USER"
          },
          "resetTime": {
            "type": "string",
            "format": "date-time",
            "description": "When failed attempt counter resets",
            "example": "2025-11-29T14:00:00.000Z"
          },
          "notificationSent": {
            "type": "boolean",
            "description": "Whether security notification was sent",
            "example": true
          },
          "unlockMethod": {
            "type": "string",
            "enum": [
              "automatic",
              "admin_unlock",
              "password_reset"
            ],
            "description": "How the account can be unlocked",
            "example": "automatic"
          }
        }
      },
      "SecurityViolationDetails": {
        "type": "object",
        "description": "Details about security violations and suspicious activity",
        "properties": {
          "violationType": {
            "type": "string",
            "enum": [
              "CONTEXT_MISMATCH",
              "IP_SUSPICIOUS",
              "MULTIPLE_LOCATIONS",
              "RAPID_REQUESTS",
              "PATTERN_ANOMALY"
            ],
            "description": "Type of security violation detected",
            "example": "CONTEXT_MISMATCH"
          },
          "severity": {
            "type": "string",
            "enum": [
              "LOW",
              "MEDIUM",
              "HIGH",
              "CRITICAL"
            ],
            "description": "Severity level of the security violation",
            "example": "HIGH"
          },
          "detectionTime": {
            "type": "string",
            "format": "date-time",
            "description": "When the violation was detected",
            "example": "2025-11-29T12:00:00.000Z"
          },
          "ipAddress": {
            "type": "string",
            "description": "IP address associated with the violation",
            "example": "192.168.1.100"
          },
          "userAgent": {
            "type": "string",
            "description": "User agent string from the request",
            "example": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
          },
          "actionTaken": {
            "type": "string",
            "enum": [
              "LOGGED",
              "IP_BLOCKED",
              "ACCOUNT_LOCKED",
              "ADMIN_NOTIFIED",
              "INVESTIGATION_TRIGGERED"
            ],
            "description": "Action taken in response to the violation",
            "example": "IP_BLOCKED"
          },
          "investigationId": {
            "type": "string",
            "description": "ID for tracking security investigation",
            "example": "SEC-2025-1129-001"
          }
        }
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Authentication",
      "description": "Universal authentication endpoints"
    },
    {
      "name": "Web Dashboard Authentication",
      "description": "Authentication endpoints for web dashboard users (Super Admin, Admin, Organization)"
    },
    {
      "name": "Mobile App Authentication",
      "description": "Authentication endpoints for mobile app users (Driver, Passenger)"
    },
    {
      "name": "Token Management",
      "description": "JWT token refresh and management endpoints"
    },
    {
      "name": "User Profile",
      "description": "User profile and account management endpoints"
    },
    {
      "name": "Public",
      "description": "Public endpoints that do not require authentication"
    },
    {
      "name": "System",
      "description": "System health and utility endpoints"
    },
    {
      "name": "User Hierarchy",
      "description": "User type hierarchy, permissions, and access control documentation"
    },
    {
      "name": "Context-Based Routing",
      "description": "# Context-Based Routing System\n\nThe SPTM API implements a sophisticated context-based routing system that determines authentication flows and access permissions based on the `X-App-Context` header. This system ensures proper isolation between different application contexts and enforces role-based access control.\n\n## Key Concepts\n\n### Context Header (`X-App-Context`)\nThe `X-App-Context` header is **REQUIRED** for all authentication endpoints and determines:\n- Which authentication controller handles the request\n- What user roles are allowed for the context\n- Which platform-specific features are available\n- How tokens are validated and issued\n\n### Valid Context Values\n- `web-dashboard`: For administrative web interface (Super Admin, Admin, Organization)\n- `driver-app`: For driver mobile application (Driver role only)\n- `passenger-app`: For passenger mobile application (Passenger role only)\n\n### Context Determination Process\n1. **Header Extraction**: Extract `X-App-Context` from request headers\n2. **Path Analysis**: Analyze request path for additional context clues\n3. **Context Validation**: Validate context against allowed values\n4. **Role Mapping**: Map context to appropriate user types and roles\n5. **Controller Routing**: Route to appropriate authentication controller\n\n## Context-Role Mapping\n\n| Context | Allowed Roles | Platform | Controller |\n|---------|---------------|----------|------------|\n| `web-dashboard` | SUPER_ADMIN, ADMIN, ORGANIZATION | Web | SuperAdminAuthController, AdminAuthController, OrganizationAuthController |\n| `driver-app` | DRIVER | Mobile | UserAuthController (with DRIVER role) |\n| `passenger-app` | PASSENGER | Mobile | UserAuthController (with PASSENGER role) |\n\n## Security Features\n\n### Context Isolation\n- Complete isolation between different contexts\n- Cross-context access is strictly prohibited\n- Context switching requires re-authentication\n\n### Token Context Validation\n- JWT tokens include context claims\n- Token context must match request context\n- Context mismatch results in authentication failure\n\n### Rate Limiting by Context\n- Different rate limits for different contexts\n- Context-specific abuse prevention\n- Adaptive rate limiting based on user behavior\n\n## Error Handling\n\n### Common Context Errors\n- **Missing Context Header**: 400 Bad Request\n- **Invalid Context Value**: 400 Bad Request  \n- **Context-Role Mismatch**: 401 Unauthorized\n- **Token Context Mismatch**: 401 Unauthorized\n- **Cross-Platform Access**: 403 Forbidden\n\n### Error Response Format\n```json\n{\n  \"error\": {\n    \"type\": \"CONTEXT_VALIDATION_ERROR\",\n    \"message\": \"Detailed error message\",\n    \"code\": 401,\n    \"details\": {\n      \"userRole\": \"DRIVER\",\n      \"requestedContext\": \"web-dashboard\",\n      \"allowedContexts\": [\"driver-app\"]\n    }\n  },\n  \"timestamp\": \"2025-11-29T12:00:00.000Z\",\n  \"path\": \"/api/auth/web/admin/login\"\n}\n```\n\n## Implementation Details\n\nFor complete technical documentation including middleware chain, validation logic, and troubleshooting guide, see the `ContextBasedRouting` schema in the components section.\n\n**Reference**: `#/components/schemas/ContextBasedRouting`\n"
    }
  ],
  "paths": {
    "/api/user/refresh-token": {
      "post": {
        "tags": [
          "Legacy Authentication"
        ],
        "summary": "Legacy refresh token endpoint",
        "description": "Legacy refresh token endpoint for backward compatibility. \n**DEPRECATED**: Use the unified refresh token endpoints instead:\n- `/api/auth/mobile/driver/refresh-token` for drivers\n- `/api/auth/mobile/passenger/refresh-token` for passengers\n\nThis endpoint automatically determines the user type from the token and refreshes accordingly.\nRequires X-App-Context header to determine the application context.\n",
        "deprecated": true,
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "driver-app",
                "passenger-app"
              ]
            },
            "description": "Application context header",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefreshTokenRequest"
              },
              "examples": {
                "driverRefresh": {
                  "summary": "Driver token refresh",
                  "value": {
                    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                },
                "passengerRefresh": {
                  "summary": "Passenger token refresh",
                  "value": {
                    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful token refresh",
                    "value": {
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid or missing context header",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "missingContext": {
                    "summary": "Missing context header",
                    "value": {
                      "error": "X-App-Context header is required",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/user/refresh-token"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/web/super-admin/login": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Super Admin login for web dashboard",
        "description": "Authenticates super admin users for web dashboard access. Requires X-App-Context header set to 'web-dashboard'.\n\n**Complete Authentication Flow Example:**\nSee the SuperAdminLoginFlow example for a comprehensive step-by-step authentication flow including:\n- Login request with proper headers\n- Success response with user data and tokens\n- Using the access token for subsequent requests\n- Context header requirements and validation\n\n**Context Requirements:**\n- X-App-Context header MUST be \"web-dashboard\"\n- Super Admin can access all administrative functions\n- Token valid for 15 minutes, refresh token valid for 7 days\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "superAdminLogin": {
                  "summary": "Super Admin Login",
                  "value": {
                    "email": "superadmin@sptm.com",
                    "password": "SuperSecure123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful super admin login",
                    "value": {
                      "message": "Super Admin login successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "superadmin@sptm.com",
                        "name": "Super Administrator",
                        "role": "SUPER_ADMIN",
                        "userType": "SUPER_ADMIN",
                        "organizationId": null,
                        "isActive": true,
                        "createdAt": "2025-11-29T10:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "423": {
            "description": "Account locked due to multiple failed attempts",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "accountLocked": {
                    "summary": "Account locked",
                    "value": {
                      "error": {
                        "type": "ACCOUNT_LOCKED",
                        "message": "Account has been locked due to multiple failed login attempts",
                        "code": 423,
                        "details": {
                          "lockoutDuration": 1800,
                          "unlockTime": "2025-11-29T12:30:00.000Z"
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/web/super-admin/login"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/web/super-admin/refresh-token": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Refresh super admin access token",
        "description": "Refreshes the access token for super admin users. Requires X-App-Context header set to 'web-dashboard'.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful token refresh",
                    "value": {
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/web/admin/login": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Admin login for web dashboard",
        "description": "Authenticates admin users for web dashboard access. Requires X-App-Context header set to 'web-dashboard'.",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "adminLogin": {
                  "summary": "Admin Login",
                  "value": {
                    "email": "admin@sptm.com",
                    "password": "AdminSecure123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful admin login",
                    "value": {
                      "message": "Admin login successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "admin@sptm.com",
                        "name": "System Administrator",
                        "role": "ADMIN",
                        "userType": "ADMIN",
                        "organizationId": null,
                        "isActive": true,
                        "createdAt": "2025-11-29T10:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/web/admin/refresh-token": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Refresh admin access token",
        "description": "Refreshes the access token for admin users. Requires X-App-Context header set to 'web-dashboard'.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/web/organization/login": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Organization login for web dashboard",
        "description": "Authenticates organization users for web dashboard access. Requires X-App-Context header set to 'web-dashboard'.",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "organizationLogin": {
                  "summary": "Organization Login",
                  "value": {
                    "email": "transport@citybus.com",
                    "password": "OrgSecure123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful organization login",
                    "value": {
                      "message": "Organization login successful",
                      "user": {
                        "id": "org_123456789",
                        "email": "transport@citybus.com",
                        "name": "City Bus Transport",
                        "role": "ORGANIZATION",
                        "userType": "ORGANIZATION",
                        "organizationId": "org_123456789",
                        "isActive": true,
                        "createdAt": "2025-11-29T10:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/web/organization/refresh-token": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Refresh organization access token",
        "description": "Refreshes the access token for organization users. Requires X-App-Context header set to 'web-dashboard'.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard"
              ]
            },
            "description": "Application context header (must be 'web-dashboard')",
            "example": "web-dashboard"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/mobile/driver/login": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Driver login for mobile app",
        "description": "Authenticates driver users for mobile app access. Requires X-App-Context header set to 'driver-app'.\n\n**Complete Authentication Flow Example:**\nSee the DriverLoginFlow example for a comprehensive step-by-step authentication flow including:\n- Login request with proper mobile app context\n- Success response with driver user data and tokens\n- Organization association requirements\n- Mobile-specific access patterns\n\n**Context Requirements:**\n- X-App-Context header MUST be \"driver-app\"\n- Driver must be associated with an active organization\n- Access to driver-specific mobile endpoints only\n- Cannot access web dashboard endpoints\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "driver-app"
              ]
            },
            "description": "Application context header (must be 'driver-app')",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "driverLogin": {
                  "summary": "Driver Login",
                  "value": {
                    "email": "driver@transport.com",
                    "password": "DriverPass123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful driver login",
                    "value": {
                      "message": "Driver login successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "driver@transport.com",
                        "name": "John Driver",
                        "role": "DRIVER",
                        "userType": "USER",
                        "organizationId": "org_123456789",
                        "isActive": true,
                        "createdAt": "2025-11-29T10:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "contextMismatch": {
                    "summary": "Invalid app context",
                    "value": {
                      "error": {
                        "type": "CONTEXT_MISMATCH",
                        "message": "Invalid app context for this endpoint",
                        "code": 403,
                        "details": {
                          "expected": "driver-app",
                          "received": "passenger-app"
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/mobile/driver/login"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/mobile/driver/register": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Driver registration for mobile app",
        "description": "Registers new driver users for mobile app access. Requires X-App-Context header set to 'driver-app' and a valid organizationId.\n\n**Complete Registration Flow Example:**\nSee the DriverRegistrationFlow example for a comprehensive step-by-step registration flow including:\n- Getting active organizations list first\n- Registration request with required organizationId\n- Success response with new driver account and tokens\n- Organization association requirements\n\n**Context Requirements:**\n- X-App-Context header MUST be \"driver-app\"\n- organizationId is REQUIRED for driver registration\n- Organization must be active and accepting new drivers\n- Password must meet security requirements\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "driver-app"
              ]
            },
            "description": "Application context header (must be 'driver-app')",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DriverRegisterRequest"
              },
              "examples": {
                "driverRegister": {
                  "summary": "Driver Registration",
                  "value": {
                    "email": "newdriver@transport.com",
                    "password": "SecurePass123!",
                    "name": "John Driver",
                    "phone": "+1234567890",
                    "organizationId": "org_123456789"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Registration successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful driver registration",
                    "value": {
                      "message": "Driver registration successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "newdriver@transport.com",
                        "name": "John Driver",
                        "role": "DRIVER",
                        "userType": "USER",
                        "organizationId": "org_123456789",
                        "isActive": true,
                        "createdAt": "2025-11-29T12:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "$ref": "#/components/responses/ConflictError"
          },
          "422": {
            "description": "Password validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "weakPassword": {
                    "summary": "Password does not meet requirements",
                    "value": {
                      "error": {
                        "type": "WEAK_PASSWORD",
                        "message": "Password does not meet security requirements",
                        "code": 422,
                        "details": {
                          "requirements": [
                            "Password must contain at least one uppercase letter",
                            "Password must contain at least one special character"
                          ]
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/mobile/driver/register"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/mobile/driver/refresh-token": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Refresh driver access token",
        "description": "Refreshes the access token for driver users. Requires X-App-Context header set to 'driver-app'.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "driver-app"
              ]
            },
            "description": "Application context header (must be 'driver-app')",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful token refresh",
                    "value": {
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/mobile/passenger/login": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Passenger login for mobile app",
        "description": "Authenticates passenger users for mobile app access. Requires X-App-Context header set to 'passenger-app'.\n\n**Complete Authentication Flow Example:**\nSee the PassengerLoginFlow example for a comprehensive step-by-step authentication flow including:\n- Login request with proper mobile app context\n- Success response with passenger user data and tokens\n- No organization association required\n- Mobile-specific access patterns\n\n**Context Requirements:**\n- X-App-Context header MUST be \"passenger-app\"\n- Passengers are not associated with organizations\n- Access to passenger-specific mobile endpoints only\n- Cannot access web dashboard or driver endpoints\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "passenger-app"
              ]
            },
            "description": "Application context header (must be 'passenger-app')",
            "example": "passenger-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "passengerLogin": {
                  "summary": "Passenger Login",
                  "value": {
                    "email": "passenger@example.com",
                    "password": "PassengerPass123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful passenger login",
                    "value": {
                      "message": "Passenger login successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "passenger@example.com",
                        "name": "Jane Passenger",
                        "role": "PASSENGER",
                        "userType": "USER",
                        "organizationId": null,
                        "isActive": true,
                        "createdAt": "2025-11-29T10:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "contextMismatch": {
                    "summary": "Invalid app context",
                    "value": {
                      "error": {
                        "type": "CONTEXT_MISMATCH",
                        "message": "Invalid app context for this endpoint",
                        "code": 403,
                        "details": {
                          "expected": "passenger-app",
                          "received": "driver-app"
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/mobile/passenger/login"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/mobile/passenger/register": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Passenger registration for mobile app",
        "description": "Registers new passenger users for mobile app access. Requires X-App-Context header set to 'passenger-app'.",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "passenger-app"
              ]
            },
            "description": "Application context header (must be 'passenger-app')",
            "example": "passenger-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PassengerRegisterRequest"
              },
              "examples": {
                "passengerRegister": {
                  "summary": "Passenger Registration",
                  "value": {
                    "email": "newpassenger@example.com",
                    "password": "SecurePass123!",
                    "name": "Jane Passenger",
                    "phone": "+1234567890"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Registration successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Successful passenger registration",
                    "value": {
                      "message": "Passenger registration successful",
                      "user": {
                        "id": "cmik7w7h700037fm9zv7btfaz",
                        "email": "newpassenger@example.com",
                        "name": "Jane Passenger",
                        "role": "PASSENGER",
                        "userType": "USER",
                        "organizationId": null,
                        "isActive": true,
                        "createdAt": "2025-11-29T12:00:00.000Z"
                      },
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "$ref": "#/components/responses/ConflictError"
          },
          "422": {
            "description": "Password validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "weakPassword": {
                    "summary": "Password does not meet requirements",
                    "value": {
                      "error": {
                        "type": "WEAK_PASSWORD",
                        "message": "Password does not meet security requirements",
                        "code": 422,
                        "details": {
                          "requirements": [
                            "Password must contain at least one uppercase letter",
                            "Password must contain at least one special character"
                          ]
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/mobile/passenger/register"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/mobile/passenger/refresh-token": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Refresh passenger access token",
        "description": "Refreshes the access token for passenger users. Requires X-App-Context header set to 'passenger-app'.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "passenger-app"
              ]
            },
            "description": "Application context header (must be 'passenger-app')",
            "example": "passenger-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful token refresh",
                    "value": {
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/web/super-admin/logout": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Super Admin logout for web dashboard",
        "description": "Logs out super admin user from web dashboard. Always succeeds regardless of authentication status.",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Super Admin logout successful"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful logout",
                    "value": {
                      "message": "Super Admin logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/web/admin/logout": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Admin logout for web dashboard",
        "description": "Logs out admin user from web dashboard. Always succeeds regardless of authentication status.",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Admin logout successful"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful logout",
                    "value": {
                      "message": "Admin logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/web/organization/logout": {
      "post": {
        "tags": [
          "Web Dashboard Authentication"
        ],
        "summary": "Organization logout for web dashboard",
        "description": "Logs out organization user from web dashboard. Always succeeds regardless of authentication status.",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Organization logout successful"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful logout",
                    "value": {
                      "message": "Organization logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": [
          "Unified Authentication"
        ],
        "summary": "Unified login endpoint with context determination",
        "description": "Unified login endpoint that automatically routes to the appropriate controller based on the X-App-Context header.\nThis endpoint determines the user type and platform from the context and routes accordingly:\n- web-dashboard context routes to super-admin, admin, or organization controllers\n- driver-app context routes to driver login\n- passenger-app context routes to passenger login\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard",
                "driver-app",
                "passenger-app"
              ]
            },
            "description": "Application context header that determines routing",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "driverLogin": {
                  "summary": "Driver Login via Unified Endpoint",
                  "value": {
                    "email": "driver@transport.com",
                    "password": "DriverPass123!"
                  }
                },
                "passengerLogin": {
                  "summary": "Passenger Login via Unified Endpoint",
                  "value": {
                    "email": "passenger@example.com",
                    "password": "PassengerPass123!"
                  }
                },
                "adminLogin": {
                  "summary": "Admin Login via Unified Endpoint",
                  "value": {
                    "email": "admin@sptm.com",
                    "password": "AdminSecure123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid user type or validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "invalidUserType": {
                    "summary": "Invalid user type",
                    "value": {
                      "error": "Invalid user type",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/login"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "403": {
            "description": "Context mismatch or invalid app context",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          },
          "500": {
            "description": "Authentication context not determined",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "contextError": {
                    "summary": "Context determination failed",
                    "value": {
                      "error": "Authentication context not determined",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/login"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "tags": [
          "Unified Authentication"
        ],
        "summary": "Unified registration endpoint (mobile only)",
        "description": "Legacy registration endpoint for mobile apps only. Automatically determines whether to register as driver or passenger based on X-App-Context header.\n- driver-app context: registers as DRIVER (requires organizationId)\n- passenger-app context: registers as PASSENGER\n",
        "security": [],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "driver-app",
                "passenger-app"
              ]
            },
            "description": "Mobile app context header (web-dashboard not supported)",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  {
                    "$ref": "#/components/schemas/DriverRegisterRequest"
                  },
                  {
                    "$ref": "#/components/schemas/PassengerRegisterRequest"
                  }
                ]
              },
              "examples": {
                "driverRegister": {
                  "summary": "Driver Registration via Unified Endpoint",
                  "value": {
                    "email": "newdriver@transport.com",
                    "password": "SecurePass123!",
                    "name": "John Driver",
                    "phone": "+1234567890",
                    "organizationId": "org_123456789"
                  }
                },
                "passengerRegister": {
                  "summary": "Passenger Registration via Unified Endpoint",
                  "value": {
                    "email": "newpassenger@example.com",
                    "password": "SecurePass123!",
                    "name": "Jane Passenger",
                    "phone": "+1234567890"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Registration successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "403": {
            "description": "Context mismatch or web dashboard context not allowed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "$ref": "#/components/responses/ConflictError"
          },
          "422": {
            "description": "Password validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "$ref": "#/components/responses/RateLimitError"
          }
        }
      }
    },
    "/api/auth/refresh-token": {
      "post": {
        "tags": [
          "Unified Authentication"
        ],
        "summary": "Unified refresh token endpoint",
        "description": "Unified refresh token endpoint that automatically routes to the appropriate controller based on the user type determined from the token.\nSupports all user types: SUPER_ADMIN, ADMIN, ORGANIZATION, and USER (drivers/passengers).\n",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-App-Context",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "web-dashboard",
                "driver-app",
                "passenger-app"
              ]
            },
            "description": "Application context header",
            "example": "driver-app"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "tokens"
                  ],
                  "properties": {
                    "tokens": {
                      "$ref": "#/components/schemas/TokenResponse"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful token refresh",
                    "value": {
                      "tokens": {
                        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid user type",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "invalidUserType": {
                    "summary": "Invalid user type",
                    "value": {
                      "error": "Invalid user type",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/refresh-token"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          },
          "500": {
            "description": "Authentication context not determined",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "contextError": {
                    "summary": "Context determination failed",
                    "value": {
                      "error": "Authentication context not determined",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/refresh-token"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/mobile/driver/logout": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Driver logout for mobile app",
        "description": "Logs out driver user from mobile app. Always succeeds regardless of authentication status.",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Driver logout successful"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful logout",
                    "value": {
                      "message": "Driver logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/mobile/passenger/logout": {
      "post": {
        "tags": [
          "Mobile App Authentication"
        ],
        "summary": "Passenger logout for mobile app",
        "description": "Logs out passenger user from mobile app. Always succeeds regardless of authentication status.",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Passenger logout successful"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful logout",
                    "value": {
                      "message": "Passenger logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Universal logout endpoint",
        "description": "Logs out user from any context (always succeeds).\n\n**Complete Logout Flow Example:**\nSee the UniversalLogoutFlow example for a comprehensive logout flow including:\n- Simple logout request (no authentication required)\n- Success response (always returns success)\n- Token invalidation on server side\n- Client-side token cleanup requirements\n\n**Context Requirements:**\n- No authentication required\n- No context header required\n- Always returns success\n- Invalidates tokens on server side if provided\n",
        "security": [],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/me": {
      "get": {
        "tags": [
          "User Profile"
        ],
        "summary": "Get current user information",
        "description": "Returns information about the currently authenticated user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User information retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/profile": {
      "get": {
        "tags": [
          "User Profile"
        ],
        "summary": "Get user profile",
        "description": "Returns detailed profile information for the authenticated user including organization details if applicable",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfile"
                },
                "examples": {
                  "driverProfile": {
                    "summary": "Driver profile with organization",
                    "value": {
                      "id": "cmik7w7h700037fm9zv7btfaz",
                      "email": "driver@transport.com",
                      "name": "John Driver",
                      "phone": "+1234567890",
                      "role": "DRIVER",
                      "userType": "USER",
                      "organizationId": "org_123456789",
                      "organization": {
                        "id": "org_123456789",
                        "name": "City Bus Transport",
                        "email": "citybus@sptm.com",
                        "isActive": true
                      },
                      "isActive": true,
                      "createdAt": "2025-11-29T10:00:00.000Z",
                      "updatedAt": "2025-11-29T11:00:00.000Z"
                    }
                  },
                  "passengerProfile": {
                    "summary": "Passenger profile",
                    "value": {
                      "id": "cmik7w7h700037fm9zv7btfaz",
                      "email": "passenger@example.com",
                      "name": "Jane Passenger",
                      "phone": "+1234567890",
                      "role": "PASSENGER",
                      "userType": "USER",
                      "organizationId": null,
                      "organization": null,
                      "isActive": true,
                      "createdAt": "2025-11-29T10:00:00.000Z",
                      "updatedAt": "2025-11-29T11:00:00.000Z"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/change-password": {
      "put": {
        "tags": [
          "User Profile"
        ],
        "summary": "Change user password",
        "description": "Allows authenticated users to change their password. Requires current password for verification.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePasswordRequest"
              },
              "examples": {
                "changePassword": {
                  "summary": "Change password request",
                  "value": {
                    "currentPassword": "OldPassword123!",
                    "newPassword": "NewSecurePassword123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password changed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "message"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Password changed successfully"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful password change",
                    "value": {
                      "message": "Password changed successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error or incorrect current password",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "incorrectPassword": {
                    "summary": "Incorrect current password",
                    "value": {
                      "error": "Current password is incorrect",
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/change-password"
                    }
                  },
                  "validationError": {
                    "summary": "Password validation failed",
                    "value": {
                      "error": {
                        "type": "WEAK_PASSWORD",
                        "message": "New password does not meet security requirements",
                        "code": 400,
                        "details": {
                          "requirements": [
                            "Password must contain at least one uppercase letter",
                            "Password must contain at least one special character"
                          ]
                        }
                      },
                      "timestamp": "2025-11-29T12:00:00.000Z",
                      "path": "/api/auth/change-password"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/AuthenticationError"
          }
        }
      }
    },
    "/api/auth/organizations/active": {
      "get": {
        "tags": [
          "Public"
        ],
        "summary": "Get active organizations",
        "description": "Returns list of active organizations for driver registration",
        "security": [],
        "responses": {
          "200": {
            "description": "Active organizations retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "Organization ID",
                        "example": "cmijzmxb10004uzqrfb18znrz"
                      },
                      "name": {
                        "type": "string",
                        "description": "Organization name",
                        "example": "City Bus Transport"
                      },
                      "email": {
                        "type": "string",
                        "format": "email",
                        "description": "Organization contact email",
                        "example": "citybus@sptm.com"
                      },
                      "isActive": {
                        "type": "boolean",
                        "description": "Whether the organization is active",
                        "example": true
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    },
    "/api/docs/rbac-guide": {
      "get": {
        "tags": [
          "Role-Based Access Control"
        ],
        "summary": "Comprehensive RBAC Implementation Guide",
        "description": "# Role-Based Access Control Implementation Guide\n\nThis guide provides comprehensive documentation for implementing and using\nthe Role-Based Access Control (RBAC) system in the SPTM API.\n\n## Quick Start Examples\n\n### Basic Authentication and Authorization\n\n**Step 1: Login with proper context**\n```http\nPOST /api/auth/web/super-admin/login\nX-App-Context: web-dashboard\nContent-Type: application/json\n\n{\n  \"email\": \"superadmin@sptm.com\",\n  \"password\": \"SuperSecure123!\"\n}\n\nResponse:\n{\n  \"message\": \"Login successful\",\n  \"user\": {\n    \"id\": \"cmik7w7h700037fm9zv7btfaz\",\n    \"email\": \"superadmin@sptm.com\",\n    \"name\": \"Super Administrator\",\n    \"role\": \"SUPER_ADMIN\",\n    \"userType\": \"SUPER_ADMIN\"\n  },\n  \"tokens\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n  }\n}\n```\n\n**Step 2: Use token for protected endpoints**\n```http\nGET /api/admin/users\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\nX-App-Context: web-dashboard\n\nResponse: 200 OK (Super Admin can access all resources)\n```\n\n### Organization Boundary Example\n\n**Organization Manager accessing own drivers (✅ Allowed)**\n```http\nGET /api/organizations/org_123456789/drivers\nAuthorization: Bearer <organization_token>\nX-App-Context: web-dashboard\n\nResponse: 200 OK\n[\n  {\n    \"id\": \"driver_001\",\n    \"name\": \"John Driver\",\n    \"organizationId\": \"org_123456789\"\n  }\n]\n```\n\n**Organization Manager accessing other organization's drivers (❌ Blocked)**\n```http\nGET /api/organizations/org_987654321/drivers\nAuthorization: Bearer <organization_token>\nX-App-Context: web-dashboard\n\nResponse: 403 Forbidden\n{\n  \"error\": {\n    \"type\": \"ORGANIZATION_BOUNDARY_VIOLATION\",\n    \"message\": \"Cannot access data from other organizations\",\n    \"code\": 403,\n    \"details\": {\n      \"userOrganizationId\": \"org_123456789\",\n      \"requestedOrganizationId\": \"org_987654321\"\n    }\n  }\n}\n```\n\n### Context-Based Access Control\n\n**Driver using correct context (✅ Allowed)**\n```http\nPOST /api/auth/mobile/driver/login\nX-App-Context: driver-app\nContent-Type: application/json\n\n{\n  \"email\": \"driver@transport.com\",\n  \"password\": \"DriverPass123!\"\n}\n\nResponse: 200 OK\n```\n\n**Driver using wrong context (❌ Blocked)**\n```http\nPOST /api/auth/web/admin/login\nX-App-Context: web-dashboard\nContent-Type: application/json\n\n{\n  \"email\": \"driver@transport.com\",\n  \"password\": \"DriverPass123!\"\n}\n\nResponse: 401 Unauthorized\n{\n  \"error\": {\n    \"type\": \"CONTEXT_MISMATCH\",\n    \"message\": \"User role DRIVER is not allowed in web-dashboard context\"\n  }\n}\n```\n\n## Permission Matrix Reference\n\n### Resource Access Permissions\n\n| Resource | SUPER_ADMIN | ADMIN | ORGANIZATION | DRIVER | PASSENGER |\n|----------|-------------|-------|--------------|--------|-----------|\n| System Config | Full | Read | None | None | None |\n| Admins | Full | None | None | None | None |\n| Organizations | Full | Full | Own Only | None | None |\n| Users/Drivers | Full | Read | Own Org Only | Own Only | Own Only |\n| Vehicles | Full | Read | Own Org Only | Assigned Only | Read |\n| Routes | Full | Full | Read | Read | Read |\n| Trips | Full | Read | Own Org Only | Own Only | Own Only |\n| Discounts | Full | Full | None | None | Own Only |\n| Verification | Full | Full | None | None | Own Only |\n\n### Permission Levels Explained\n- **Full**: Complete CRUD access (Create, Read, Update, Delete)\n- **Read**: Read-only access to all resources of this type\n- **Own Only**: Access limited to user's own resources\n- **Own Org Only**: Access limited to user's organization resources\n- **Assigned Only**: Access limited to resources assigned to the user\n- **None**: No access to the resource\n\n## Common Implementation Patterns\n\n### Pattern 1: Role-Based Endpoint Protection\n```typescript\n// Protect endpoint for ADMIN and above\nrouter.get('/admin/users', \n  authenticate, \n  authorizeRole('ADMIN'), \n  getUserList\n);\n\n// Protect endpoint for SUPER_ADMIN only\nrouter.post('/admin/create', \n  authenticate, \n  authorizeRole('SUPER_ADMIN'), \n  createAdmin\n);\n```\n\n### Pattern 2: Permission-Based Protection\n```typescript\n// Require specific permissions\nrouter.put('/organizations/:id', \n  authenticate, \n  authorizePermission(['organizations:update']), \n  updateOrganization\n);\n\n// Require multiple permissions\nrouter.delete('/users/:id', \n  authenticate, \n  authorizePermission(['users:delete', 'users:manage']), \n  deleteUser\n);\n```\n\n### Pattern 3: Organization Boundary Enforcement\n```typescript\n// Enforce organization boundaries\nrouter.get('/organizations/:organizationId/drivers', \n  authenticate, \n  authorizeOrganization, \n  getOrganizationDrivers\n);\n\n// Combined role and organization check\nrouter.post('/organizations/:organizationId/vehicles', \n  authenticate, \n  authorizeRole('ORGANIZATION'), \n  authorizeOrganization, \n  createVehicle\n);\n```\n\n### Pattern 4: Context-Based Protection\n```typescript\n// Web dashboard only\nrouter.get('/admin/dashboard', \n  authenticate, \n  authorizeContext(['web']), \n  getDashboard\n);\n\n// Mobile app only\nrouter.get('/mobile/profile', \n  authenticate, \n  authorizeContext(['mobile-driver', 'mobile-passenger']), \n  getMobileProfile\n);\n```\n\n### Pattern 5: Combined Protection\n```typescript\n// Full protection stack\nrouter.put('/organizations/:organizationId/drivers/:driverId', \n  authenticate,                                    // Verify token\n  authorizeRole('ORGANIZATION'),                   // Must be organization manager\n  authorizeOrganization,                          // Must be same organization\n  authorizeContext(['web']),                      // Web dashboard only\n  authorizePermission(['drivers:update']),        // Must have driver update permission\n  updateDriver\n);\n```\n\n## Error Handling Best Practices\n\n### Client-Side Error Handling\n```typescript\nasync function makeAuthenticatedRequest(url: string, options: RequestInit) {\n  try {\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        ...options.headers,\n        'Authorization': `Bearer ${getToken()}`,\n        'X-App-Context': getAppContext()\n      }\n    });\n    \n    if (!response.ok) {\n      const error = await response.json();\n      \n      switch (error.error?.type) {\n        case 'INSUFFICIENT_PERMISSIONS':\n          showError('You do not have permission to perform this action');\n          break;\n        case 'ORGANIZATION_BOUNDARY_VIOLATION':\n          showError('You can only access data from your own organization');\n          break;\n        case 'CONTEXT_MISMATCH':\n          showError('This action is not available in your current app context');\n          redirectToCorrectApp();\n          break;\n        case 'TOKEN_EXPIRED':\n          await refreshToken();\n          return makeAuthenticatedRequest(url, options); // Retry\n        default:\n          showError('An error occurred. Please try again.');\n      }\n    }\n    \n    return response;\n  } catch (error) {\n    showError('Network error. Please check your connection.');\n    throw error;\n  }\n}\n```\n\n### Server-Side Error Responses\n```typescript\n// Consistent error response format\nfunction sendAccessControlError(res: Response, type: string, message: string, details?: any) {\n  const statusCode = getStatusCodeForErrorType(type);\n  \n  res.status(statusCode).json({\n    error: {\n      type,\n      message,\n      code: statusCode,\n      details\n    },\n    timestamp: new Date().toISOString(),\n    path: req.path\n  });\n}\n```\n\n## Security Considerations\n\n### Token Security\n- Always use HTTPS in production\n- Store tokens securely (HttpOnly cookies or secure storage)\n- Implement token refresh mechanism\n- Use short token expiration times (15 minutes recommended)\n- Validate token context on every request\n\n### Permission Validation\n- Never trust client-side permission checks\n- Always validate permissions on the server\n- Use principle of least privilege\n- Regularly audit user permissions\n- Log all access control decisions\n\n### Organization Boundaries\n- Strictly enforce organization data isolation\n- Validate organization IDs in all requests\n- Never allow cross-organization data access for bounded users\n- Audit organization boundary violations\n\n### Context Validation\n- Always require X-App-Context header\n- Validate context matches user role\n- Prevent context switching without re-authentication\n- Monitor context mismatch attempts\n\n## Testing Access Control\n\n### Unit Tests\n```typescript\ndescribe('Access Control Middleware', () => {\n  it('should allow SUPER_ADMIN to access all resources', async () => {\n    const req = mockRequest({ user: { userType: 'SUPER_ADMIN' } });\n    const res = mockResponse();\n    const next = jest.fn();\n    \n    authorizeRole('ADMIN')(req, res, next);\n    \n    expect(next).toHaveBeenCalled();\n    expect(res.status).not.toHaveBeenCalled();\n  });\n  \n  it('should block USER from accessing ADMIN resources', async () => {\n    const req = mockRequest({ user: { userType: 'USER', role: 'DRIVER' } });\n    const res = mockResponse();\n    const next = jest.fn();\n    \n    authorizeRole('ADMIN')(req, res, next);\n    \n    expect(next).not.toHaveBeenCalled();\n    expect(res.status).toHaveBeenCalledWith(403);\n  });\n});\n```\n\n### Integration Tests\n```typescript\ndescribe('Organization Boundary Enforcement', () => {\n  it('should allow organization to access own drivers', async () => {\n    const token = await loginAsOrganization('org_123456789');\n    \n    const response = await request(app)\n      .get('/api/organizations/org_123456789/drivers')\n      .set('Authorization', `Bearer ${token}`)\n      .set('X-App-Context', 'web-dashboard');\n    \n    expect(response.status).toBe(200);\n  });\n  \n  it('should block organization from accessing other organization drivers', async () => {\n    const token = await loginAsOrganization('org_123456789');\n    \n    const response = await request(app)\n      .get('/api/organizations/org_987654321/drivers')\n      .set('Authorization', `Bearer ${token}`)\n      .set('X-App-Context', 'web-dashboard');\n    \n    expect(response.status).toBe(403);\n    expect(response.body.error.type).toBe('ORGANIZATION_BOUNDARY_VIOLATION');\n  });\n});\n```\n\n## Troubleshooting Guide\n\n### Common Issues and Solutions\n\n**Issue: \"Context mismatch\" errors**\n- **Cause**: X-App-Context header doesn't match user role\n- **Solution**: Ensure correct context header for user type\n- **Example**: DRIVER users must use \"driver-app\" context\n\n**Issue: \"Organization boundary violation\" errors**\n- **Cause**: User trying to access other organization's data\n- **Solution**: Ensure organization ID in URL matches user's organization\n- **Example**: Organization user can only access /api/organizations/{their-org-id}/*\n\n**Issue: \"Insufficient permissions\" errors**\n- **Cause**: User role doesn't have required permissions\n- **Solution**: Check permission matrix and user role assignment\n- **Example**: PASSENGER cannot access admin endpoints\n\n**Issue: Token validation failures**\n- **Cause**: Expired, invalid, or missing JWT token\n- **Solution**: Implement token refresh mechanism\n- **Example**: Refresh token when receiving 401 responses\n\n### Debug Information\nAll access control errors include detailed debugging information:\n- Current user role and permissions\n- Required role and permissions\n- Organization IDs involved\n- Context information\n- Timestamp and request path\n\nUse this information to diagnose and fix access control issues.\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "RBAC implementation guide",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "guide": {
                      "type": "string",
                      "description": "Comprehensive RBAC implementation guide"
                    },
                    "examples": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      },
                      "description": "Practical implementation examples"
                    },
                    "patterns": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      },
                      "description": "Common implementation patterns"
                    },
                    "troubleshooting": {
                      "type": "object",
                      "description": "Troubleshooting guide and solutions"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/docs/user-hierarchy": {
      "get": {
        "tags": [
          "User Hierarchy"
        ],
        "summary": "User Type Hierarchy Documentation",
        "description": "Comprehensive documentation of the SPTM user type hierarchy, access control rules, and permissions.\n\nThis endpoint provides detailed information about:\n- User type hierarchy and authority levels\n- Permission matrix for each user type\n- Organization boundary enforcement\n- Context-based access control\n- Role transition rules\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "User hierarchy documentation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserTypeHierarchy"
                },
                "examples": {
                  "completeHierarchy": {
                    "summary": "Complete user type hierarchy",
                    "value": {
                      "hierarchy": [
                        {
                          "userType": "SUPER_ADMIN",
                          "role": "SUPER_ADMIN",
                          "authorityLevel": 4,
                          "organizationBoundary": false,
                          "contextAccess": [
                            "web-dashboard"
                          ],
                          "permissions": [
                            "*"
                          ],
                          "description": "System-wide administration with unrestricted access",
                          "capabilities": [
                            "Manage all admins and organizations",
                            "Access all system configurations",
                            "Override organizational boundaries",
                            "Full CRUD on all resources"
                          ],
                          "restrictions": []
                        },
                        {
                          "userType": "ADMIN",
                          "role": "ADMIN",
                          "authorityLevel": 3,
                          "organizationBoundary": false,
                          "contextAccess": [
                            "web-dashboard"
                          ],
                          "permissions": [
                            "organizations:read",
                            "organizations:create",
                            "organizations:update",
                            "users:read",
                            "routes:manage",
                            "verification:approve"
                          ],
                          "description": "Regional administration with cross-organizational access",
                          "capabilities": [
                            "Create and manage organizations",
                            "Manage routes and system configurations",
                            "Approve verification requests",
                            "Access system metrics"
                          ],
                          "restrictions": [
                            "Cannot manage other admins or super admins"
                          ]
                        },
                        {
                          "userType": "ORGANIZATION",
                          "role": "ORGANIZATION",
                          "authorityLevel": 2,
                          "organizationBoundary": true,
                          "contextAccess": [
                            "web-dashboard"
                          ],
                          "permissions": [
                            "drivers:manage",
                            "vehicles:manage",
                            "organization:update",
                            "routes:read"
                          ],
                          "description": "Organization-specific management within boundary",
                          "capabilities": [
                            "Manage drivers within organization",
                            "Manage organization vehicles",
                            "Update organization profile",
                            "View organization-related trips"
                          ],
                          "restrictions": [
                            "Cannot access other organizations' data",
                            "Cannot manage system-wide settings"
                          ]
                        },
                        {
                          "userType": "USER",
                          "role": "DRIVER",
                          "authorityLevel": 1,
                          "organizationBoundary": true,
                          "contextAccess": [
                            "driver-app"
                          ],
                          "permissions": [
                            "profile:update",
                            "vehicle:read",
                            "routes:read",
                            "trips:update-status"
                          ],
                          "description": "Vehicle operation and trip management",
                          "capabilities": [
                            "View and update own profile",
                            "View assigned vehicle information",
                            "View assigned routes",
                            "Update trip status"
                          ],
                          "restrictions": [
                            "Cannot access other drivers' data",
                            "Cannot manage organization resources",
                            "Limited to mobile app context only"
                          ]
                        },
                        {
                          "userType": "USER",
                          "role": "PASSENGER",
                          "authorityLevel": 1,
                          "organizationBoundary": false,
                          "contextAccess": [
                            "passenger-app"
                          ],
                          "permissions": [
                            "profile:update",
                            "trips:create",
                            "trips:read",
                            "discounts:apply",
                            "verification:submit"
                          ],
                          "description": "Trip booking and profile management",
                          "capabilities": [
                            "View and update own profile",
                            "Book and manage own trips",
                            "View public routes and schedules",
                            "Apply for discount profiles",
                            "Submit verification documents"
                          ],
                          "restrictions": [
                            "Cannot access other passengers' data",
                            "Cannot manage system resources",
                            "Limited to mobile app context only"
                          ]
                        }
                      ],
                      "accessControlRules": {
                        "hierarchicalAccess": "Higher authority levels can access resources of lower levels within their scope",
                        "organizationBoundaryEnforcement": {
                          "noBoundary": [
                            "SUPER_ADMIN",
                            "ADMIN",
                            "PASSENGER"
                          ],
                          "strictBoundary": [
                            "ORGANIZATION",
                            "DRIVER"
                          ]
                        },
                        "contextBasedAccess": {
                          "web-dashboard": [
                            "SUPER_ADMIN",
                            "ADMIN",
                            "ORGANIZATION"
                          ],
                          "driver-app": [
                            "DRIVER"
                          ],
                          "passenger-app": [
                            "PASSENGER"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/docs/permission-matrix": {
      "get": {
        "tags": [
          "User Hierarchy"
        ],
        "summary": "Permission Matrix Documentation",
        "description": "Detailed permission matrix showing what each user type can access and manage.\n\nThis matrix defines the exact permissions for each resource type across all user types.\nUse this to understand what operations are allowed for each user type.\n\n**Permission Levels**:\n- **Full**: Complete CRUD access (Create, Read, Update, Delete)\n- **Read**: Read-only access to resources\n- **Own Only**: Access limited to user's own resources\n- **Assigned Only**: Access limited to resources assigned to the user\n- **None**: No access to the resource\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "Permission matrix documentation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PermissionMatrix"
                },
                "examples": {
                  "fullMatrix": {
                    "summary": "Complete permission matrix",
                    "value": {
                      "resources": {
                        "systemConfig": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Read",
                          "ORGANIZATION": "None",
                          "DRIVER": "None",
                          "PASSENGER": "None",
                          "description": "System-wide configuration and settings"
                        },
                        "admins": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "None",
                          "ORGANIZATION": "None",
                          "DRIVER": "None",
                          "PASSENGER": "None",
                          "description": "Admin user management"
                        },
                        "organizations": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Full",
                          "ORGANIZATION": "Own Only",
                          "DRIVER": "None",
                          "PASSENGER": "None",
                          "description": "Organization management and configuration"
                        },
                        "users": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Read",
                          "ORGANIZATION": "Own Only",
                          "DRIVER": "Own Only",
                          "PASSENGER": "Own Only",
                          "description": "User profile and account management"
                        },
                        "vehicles": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Read",
                          "ORGANIZATION": "Own Only",
                          "DRIVER": "Assigned Only",
                          "PASSENGER": "Read",
                          "description": "Vehicle management and information"
                        },
                        "routes": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Full",
                          "ORGANIZATION": "Read",
                          "DRIVER": "Read",
                          "PASSENGER": "Read",
                          "description": "Route management and information"
                        },
                        "trips": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Read",
                          "ORGANIZATION": "Own Only",
                          "DRIVER": "Own Only",
                          "PASSENGER": "Own Only",
                          "description": "Trip booking and management"
                        },
                        "discounts": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Full",
                          "ORGANIZATION": "None",
                          "DRIVER": "None",
                          "PASSENGER": "Own Only",
                          "description": "Discount profile and verification management"
                        },
                        "verification": {
                          "SUPER_ADMIN": "Full",
                          "ADMIN": "Full",
                          "ORGANIZATION": "None",
                          "DRIVER": "None",
                          "PASSENGER": "Own Only",
                          "description": "Document verification and approval"
                        }
                      },
                      "permissionDetails": {
                        "Full": {
                          "description": "Complete CRUD access (Create, Read, Update, Delete)",
                          "operations": [
                            "GET",
                            "POST",
                            "PUT",
                            "DELETE"
                          ],
                          "scope": "All resources of this type"
                        },
                        "Read": {
                          "description": "Read-only access to resources",
                          "operations": [
                            "GET"
                          ],
                          "scope": "All resources of this type"
                        },
                        "Own Only": {
                          "description": "Access limited to user's own resources",
                          "operations": [
                            "GET",
                            "PUT"
                          ],
                          "scope": "Resources owned by or associated with the user"
                        },
                        "Assigned Only": {
                          "description": "Access limited to resources assigned to the user",
                          "operations": [
                            "GET"
                          ],
                          "scope": "Resources specifically assigned to the user"
                        },
                        "None": {
                          "description": "No access to the resource",
                          "operations": [],
                          "scope": "No access"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/docs/access-control-examples": {
      "get": {
        "tags": [
          "User Hierarchy"
        ],
        "summary": "Access Control Examples",
        "description": "Real-world examples of access control enforcement, including successful access\nand various types of access violations.\n\nThese examples demonstrate:\n- Organization boundary enforcement\n- Context-based access control\n- Permission-based access control\n- Hierarchical access patterns\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "Access control examples",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "successfulAccess": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AccessControlExample"
                      }
                    },
                    "accessViolations": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AccessControlExample"
                      }
                    }
                  }
                },
                "examples": {
                  "accessExamples": {
                    "summary": "Access control examples",
                    "value": {
                      "successfulAccess": [
                        {
                          "scenario": "Super Admin accessing any organization",
                          "userType": "SUPER_ADMIN",
                          "userRole": "SUPER_ADMIN",
                          "userOrganizationId": null,
                          "requestedEndpoint": "GET /api/organizations/org_123456789/drivers",
                          "context": "web-dashboard",
                          "result": "SUCCESS",
                          "reason": "Super Admin has unrestricted access to all resources"
                        },
                        {
                          "scenario": "Organization manager accessing own drivers",
                          "userType": "ORGANIZATION",
                          "userRole": "ORGANIZATION",
                          "userOrganizationId": "org_123456789",
                          "requestedEndpoint": "GET /api/organizations/org_123456789/drivers",
                          "context": "web-dashboard",
                          "result": "SUCCESS",
                          "reason": "User can access resources within their own organization"
                        },
                        {
                          "scenario": "Driver accessing own profile",
                          "userType": "USER",
                          "userRole": "DRIVER",
                          "userOrganizationId": "org_123456789",
                          "requestedEndpoint": "GET /api/auth/me",
                          "context": "driver-app",
                          "result": "SUCCESS",
                          "reason": "Driver can access their own profile information"
                        },
                        {
                          "scenario": "Passenger booking a trip",
                          "userType": "USER",
                          "userRole": "PASSENGER",
                          "userOrganizationId": null,
                          "requestedEndpoint": "POST /api/trips",
                          "context": "passenger-app",
                          "result": "SUCCESS",
                          "reason": "Passenger can create trips for themselves"
                        }
                      ],
                      "accessViolations": [
                        {
                          "scenario": "Organization accessing other organization's data",
                          "userType": "ORGANIZATION",
                          "userRole": "ORGANIZATION",
                          "userOrganizationId": "org_123456789",
                          "requestedEndpoint": "GET /api/organizations/org_987654321/drivers",
                          "context": "web-dashboard",
                          "result": "ORGANIZATION_BOUNDARY_VIOLATION",
                          "httpStatus": 403,
                          "reason": "Organization cannot access other organizations' resources",
                          "errorResponse": {
                            "error": {
                              "type": "ORGANIZATION_BOUNDARY_VIOLATION",
                              "message": "User cannot access resources outside their organization",
                              "code": 403,
                              "details": {
                                "userOrganizationId": "org_123456789",
                                "requestedOrganizationId": "org_987654321"
                              }
                            }
                          }
                        },
                        {
                          "scenario": "Driver using wrong context",
                          "userType": "USER",
                          "userRole": "DRIVER",
                          "userOrganizationId": "org_123456789",
                          "requestedEndpoint": "POST /api/auth/web/organization/login",
                          "context": "web-dashboard",
                          "result": "CONTEXT_MISMATCH",
                          "httpStatus": 401,
                          "reason": "Driver cannot access web dashboard endpoints",
                          "errorResponse": {
                            "error": {
                              "type": "CONTEXT_MISMATCH",
                              "message": "User context does not match required application context",
                              "code": 401,
                              "details": {
                                "userRole": "DRIVER",
                                "expectedContext": "driver-app",
                                "actualContext": "web-dashboard"
                              }
                            }
                          }
                        },
                        {
                          "scenario": "Passenger accessing admin functions",
                          "userType": "USER",
                          "userRole": "PASSENGER",
                          "userOrganizationId": null,
                          "requestedEndpoint": "GET /api/admin/users",
                          "context": "passenger-app",
                          "result": "INSUFFICIENT_PERMISSIONS",
                          "httpStatus": 403,
                          "reason": "Passenger does not have admin permissions",
                          "errorResponse": {
                            "error": {
                              "type": "INSUFFICIENT_PERMISSIONS",
                              "message": "User does not have required permissions",
                              "code": 403,
                              "details": {
                                "requiredRole": "ADMIN",
                                "userRole": "PASSENGER",
                                "requiredPermissions": [
                                  "users:read",
                                  "users:manage"
                                ],
                                "userPermissions": [
                                  "profile:update",
                                  "trips:create"
                                ]
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/docs/role-transitions": {
      "get": {
        "tags": [
          "User Hierarchy"
        ],
        "summary": "Role Transition Rules",
        "description": "Documentation of role transition rules, allowed promotions, and restrictions.\n\nThis documentation covers:\n- Allowed role transitions and conditions\n- Restricted transitions and reasons\n- Approval processes for role changes\n- Security considerations for role transitions\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "Role transition documentation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleTransition"
                },
                "examples": {
                  "roleTransitions": {
                    "summary": "Role transition rules",
                    "value": {
                      "allowedTransitions": {
                        "SUPER_ADMIN": [
                          {
                            "from": "ADMIN",
                            "to": "SUPER_ADMIN",
                            "conditions": [
                              "Manual promotion by existing SUPER_ADMIN",
                              "System security approval"
                            ],
                            "process": "Direct promotion with full access transfer",
                            "reversible": false
                          }
                        ],
                        "ADMIN": [
                          {
                            "from": "ORGANIZATION",
                            "to": "ADMIN",
                            "conditions": [
                              "Approval by SUPER_ADMIN",
                              "Organization performance review"
                            ],
                            "process": "Promotion removes organization boundary",
                            "reversible": true
                          },
                          {
                            "from": "SUPER_ADMIN",
                            "to": "ADMIN",
                            "conditions": [
                              "Voluntary demotion",
                              "SUPER_ADMIN approval"
                            ],
                            "process": "Demotion with access restriction",
                            "reversible": true
                          }
                        ],
                        "ORGANIZATION": [
                          {
                            "from": "ADMIN",
                            "to": "ORGANIZATION",
                            "conditions": [
                              "Assignment to specific organization",
                              "SUPER_ADMIN approval"
                            ],
                            "process": "Demotion with organization boundary enforcement",
                            "reversible": true
                          }
                        ]
                      },
                      "restrictedTransitions": [
                        {
                          "from": "DRIVER",
                          "to": "ORGANIZATION",
                          "reason": "Drivers cannot become organization managers directly",
                          "alternative": "Must be promoted to ADMIN first, then assigned to organization"
                        },
                        {
                          "from": "PASSENGER",
                          "to": "ADMIN",
                          "reason": "Passengers cannot become system administrators directly",
                          "alternative": "Must apply through official channels and undergo security clearance"
                        },
                        {
                          "from": "USER",
                          "to": "SUPER_ADMIN",
                          "reason": "Users cannot become super administrators directly",
                          "alternative": "Must progress through ADMIN role first"
                        },
                        {
                          "from": "ORGANIZATION",
                          "to": "SUPER_ADMIN",
                          "reason": "Organization managers cannot become super administrators directly",
                          "alternative": "Must be promoted to ADMIN first, then to SUPER_ADMIN"
                        }
                      ],
                      "securityConsiderations": [
                        {
                          "consideration": "Role transitions require audit logging",
                          "description": "All role changes must be logged with timestamp, approver, and reason"
                        },
                        {
                          "consideration": "Multi-factor authentication required for promotions",
                          "description": "Promotions to ADMIN or SUPER_ADMIN require additional authentication"
                        },
                        {
                          "consideration": "Cooling-off period for demotions",
                          "description": "Demoted users cannot be re-promoted for 30 days"
                        },
                        {
                          "consideration": "Organization boundary changes require data migration",
                          "description": "Moving users between organizations requires careful data handling"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/docs/context-validation": {
      "get": {
        "tags": [
          "User Hierarchy"
        ],
        "summary": "Context Validation Rules",
        "description": "Detailed documentation of context validation rules and requirements.\n\nContext validation ensures users can only access endpoints appropriate\nfor their application context (web-dashboard, driver-app, passenger-app).\n\n**Note**: This is documentation only - no actual endpoint exists at this path.\n",
        "security": [],
        "responses": {
          "200": {
            "description": "Context validation documentation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ContextValidation"
                }
              }
            }
          }
        }
      }
    }
  }
}